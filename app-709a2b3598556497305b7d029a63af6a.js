"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function intern(e){return e}function debugAssert(e,t){if(alreadyWarned||(alreadyWarned=!0,LOGGER.warn("Don't leave debug assertions on in public builds")),!e)throw new Error(t||"assertion failure")}function forEach(e,t){var n=arguments.length<=2||void 0===arguments[2]?void 0:arguments[2],i=void 0,r=void 0;if(void 0===n)for(i=0,r=e.length;i<r;i++)t(e[i],i,e);else for(i=0,r=e.length;i<r;i++)t.call(n,e[i],i,e)}function assign(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return n.reduce(function(e,t){return Object.keys(t).forEach(function(n){return e[n]=t[n]}),e},e)}function initializeGuid(e){return e._guid=++GUID}function ensureGuid(e){return e._guid||initializeGuid(e)}function EmptyObject(){}function dict(){return new EmptyObject}function EMPTY_CACHE(){}function combineTagged(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n].tag;if(r===VOLATILE_TAG)return VOLATILE_TAG;r!==CONSTANT_TAG&&t.push(r)}return _combine(t)}function combineSlice(e){for(var t=[],n=e.head();null!==n;){var i=n.tag;if(i===VOLATILE_TAG)return VOLATILE_TAG;i!==CONSTANT_TAG&&t.push(i),n=e.nextNode(n)}return _combine(t)}function combine(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];if(r===VOLATILE_TAG)return VOLATILE_TAG;r!==CONSTANT_TAG&&t.push(r)}return _combine(t)}function _combine(e){switch(e.length){case 0:return CONSTANT_TAG;case 1:return e[0];case 2:return new TagsPair(e[0],e[1]);default:return new TagsCombinator(e)}}function map$1(e,t){return new MapperReference(e,t)}function isModified(e){return e!==NOT_MODIFIED}function isConst(e){return!!e[CONST_REFERENCE]}function referenceFromParts(e,t){for(var n=e,i=0;i<t.length;i++)n=n.get(t[i]);return n}function moveBounds(e,t){for(var n=e.parentElement(),i=e.firstNode(),r=e.lastNode(),a=i;a;){var s=a.nextSibling;if(n.insertBefore(a,t),a===r)return s;a=s}return null}function clear(e){for(var t=e.parentElement(),n=e.firstNode(),i=e.lastNode(),r=n;r;){var a=r.nextSibling;if(t.removeChild(r),r===i)return a;r=a}return null}function toClassName(e){for(var t=[],n=0;n<e.length;n++){var i=e[n].value();i!==!1&&null!==i&&void 0!==i&&t.push(i)}return 0===t.length?null:t.join(" ")}function formatElement(e){return JSON.stringify("<"+e.tagName.toLowerCase()+" />")}function turbocharge(e){return e}function is(e){return function(t){return t[0]===e}}function buildStatement(e,t){return isYield(e)?Yield.fromSpec(e):isBlock(e)?Block.fromSpec(e,t):isAppend(e)?Append.fromSpec(e):isDynamicAttr(e)?DynamicAttr.fromSpec(e):isDynamicProp(e)?DynamicProp.fromSpec(e):isText(e)?Text$1.fromSpec(e):isComment(e)?Comment.fromSpec(e):isOpenElement(e)?OpenElement.fromSpec(e):isCloseElement(e)?CloseElement.fromSpec():isStaticAttr(e)?StaticAttr.fromSpec(e):isModifier(e)?Modifier.fromSpec(e):void 0}function make(e){return new FunctionExpressionSyntax(e)}function compileStatement(e,t,n,i){e.statement(t).compile(n,e,i)}function layoutFor(e,t){var n=e[CACHED_LAYOUT];if(n)return n;var i=new ComponentLayoutBuilder(t);return e.compile(i),e[CACHED_LAYOUT]=i.compile()}function isOpenElement$1(e){return e instanceof OpenElement||e instanceof OpenPrimitiveElement}function buildExpression(e){return isValue(e)?ValueSyntax.fromSpec(e):isAttr(e)?AttrSyntax.fromSpec(e):isConcat(e)?ConcatSyntax.fromSpec(e):isGet(e)?GetSyntax.fromSpec(e):isHelper(e)?HelperSyntax.fromSpec(e):isUnknown(e)?UnknownSyntax.fromSpec(e):isHasBlock(e)?HasBlockSyntax.fromSpec(e):isHasBlockParams(e)?HasBlockParamsSyntax.fromSpec(e):void 0}function isSafeString(e){return e&&"function"==typeof e.toHTML}function isNode(e){return null!==e&&"object"==typeof e&&"number"==typeof e.nodeType}function isString(e){return"string"==typeof e}function cautiousInsert(e,t,n){return isString(n)?TextUpsert.insert(e,t,n):isSafeString(n)?SafeStringUpsert.insert(e,t,n):isNode(n)?NodeUpsert.insert(e,t,n):void 0}function trustingInsert(e,t,n){return isString(n)?HTMLUpsert.insert(e,t,n):isNode(n)?NodeUpsert.insert(e,t,n):void 0}function isEmpty(e){return null===e||void 0===e||"function"!=typeof e.toString}function normalizeTextValue(e){return isEmpty(e)?"":String(e)}function normalizeTrustedValue(e){return isEmpty(e)?"":isString(e)?e:isSafeString(e)?e.toHTML():isNode(e)?e:String(e)}function normalizeValue(e){return isEmpty(e)?"":isString(e)?e:isSafeString(e)||isNode(e)?e:String(e)}function internPath(e){return e.split(".").map(intern)}function parseStatement(e){var t=e.type,n="block"===t?e:null,i="append"===t?e:null,r="modifier"===t?e:null,a=void 0,s=void 0,o=void 0,l=void 0,c=void 0;n?(s=n.args,a=s.named,o=n.path):i&&"unknown"===i.value.type?(l=i.value,s=Args.empty(),a=NamedArgs.empty(),o=l.ref.path()):i&&"helper"===i.value.type?(c=i.value,s=c.args,a=s.named,o=c.ref.path()):r&&(o=r.path,s=r.args);var u=void 0,h=void 0;return o&&(h=1===o.length,u=o[0]),{isSimple:h,path:o,key:u,args:s,isInline:!!i,isBlock:!!n,isModifier:!!r,templates:n&&n.templates}}function applyInnerHTMLFix(e,t){if(!e)return t;var n=e.createElement("table");try{n.innerHTML="<tbody></tbody>"}catch(e){}finally{if(0!==n.childNodes.length)return t}n=null;var i={colgroup:{depth:2,before:"<table><colgroup>",after:"</colgroup></table>"},table:{depth:1,before:"<table>",after:"</table>"},tbody:{depth:2,before:"<table><tbody>",after:"</tbody></table>"},tfoot:{depth:2,before:"<table><tfoot>",after:"</tfoot></table>"},thead:{depth:2,before:"<table><thead>",after:"</thead></table>"},tr:{depth:3,before:"<table><tbody><tr>",after:"</tr></tbody></table>"}},r=e.createElement("div");return function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"insertHTMLBefore",value:function(e,n,a){if(null===a||""===a)return _get(Object.getPrototypeOf(t.prototype),"insertHTMLBefore",this).call(this,e,n,a);var s=e.tagName.toLowerCase(),o=i[s];if(void 0===o)return _get(Object.getPrototypeOf(t.prototype),"insertHTMLBefore",this).call(this,e,n,a);var l=o.before+a+o.after;r.innerHTML=l;for(var c=r,u=0;u<o.depth;u++)c=c.childNodes[0];var h=moveNodesBefore(c,e,n),p=_slicedToArray(h,2),f=p[0],d=p[1];return new ConcreteBounds(e,f,d)}}]),t}(t)}function applyInnerHTMLFix$1(e,t,n){if(!e)return t;var i=e.createElementNS(n,"svg");try{i.insertAdjacentHTML("beforeEnd","<circle></circle>")}catch(e){}finally{if(1===i.childNodes.length&&i.firstChild.namespaceURI===SVG_NAMESPACE$1)return t;i=null}var r=e.createElement("div");return function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"insertHTMLBefore",value:function(e,i,a){if(null===a||""===a)return _get(Object.getPrototypeOf(t.prototype),"insertHTMLBefore",this).call(this,e,i,a);if(e.namespaceURI!==n)return _get(Object.getPrototypeOf(t.prototype),"insertHTMLBefore",this).call(this,e,i,a);var s="<svg>"+a+"</svg>";r.innerHTML=s;var o=moveNodesBefore(r.firstChild,e,i),l=_slicedToArray(o,2),c=l[0],u=l[1];return new ConcreteBounds(e,c,u)}}]),t}(t)}function applyTextNodeMergingFix(e,t){if(!e)return t;var n=e.createElement("div");return n.innerHTML="first",n.insertAdjacentHTML("beforeEnd","second"),2===n.childNodes.length?t:(n=null,function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.uselessComment=this.createComment("")}return _inherits(t,e),_createClass(t,[{key:"insertHTMLBefore",value:function(e,n,i){if(null===i)return _get(Object.getPrototypeOf(t.prototype),"insertHTMLBefore",this).call(this,e,n,i);var r=!1,a=n?n.previousSibling:e.lastChild;a&&a instanceof Text&&(r=!0,e.insertBefore(this.uselessComment,n));var s=_get(Object.getPrototypeOf(t.prototype),"insertHTMLBefore",this).call(this,e,n,i);return r&&e.removeChild(this.uselessComment),s}}]),t}(t))}function moveNodesBefore(e,t,n){for(var i=e.firstChild,r=null,a=i;a;)r=a,a=a.nextSibling,t.insertBefore(r,n);return[i,r]}function isDocumentFragment(e){return e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}var _slicedToArray=function(){function e(e,t){var n=[],i=!0,r=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{!i&&o.return&&o.return()}finally{if(r)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_get=function(e,t,n){for(var i=!0;i;){var r=e,a=t,s=n;i=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var l=o.get;if(void 0===l)return;return l.call(s)}var c=Object.getPrototypeOf(r);if(null===c)return;e=c,t=a,n=s,i=!0,o=c=void 0}},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),BASE_KEY=intern("__glimmer{+ new Date()}"),LogLevel;!function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Warn=2]="Warn",e[e.Error=3]="Error"}(LogLevel||(LogLevel={}));var NullConsole=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"log",value:function(e){}},{key:"warn",value:function(e){}},{key:"error",value:function(e){}},{key:"trace",value:function(){}}]),e}(),Logger=function(){function e(t){var n=t.console,i=t.level;_classCallCheck(this,e),this.f=ALWAYS,this.force=ALWAYS,this.console=n,this.level=i}return _createClass(e,[{key:"skipped",value:function(e){return e<this.level}},{key:"trace",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=t.stackTrace,i=void 0!==n&&n;this.skipped(LogLevel.Trace)||(this.console.log(e),i&&this.console.trace())}},{key:"debug",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=t.stackTrace,i=void 0!==n&&n;this.skipped(LogLevel.Debug)||(this.console.log(e),i&&this.console.trace())}},{key:"warn",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=t.stackTrace,i=void 0!==n&&n;this.skipped(LogLevel.Warn)||(this.console.warn(e),i&&this.console.trace())}},{key:"error",value:function(e){this.skipped(LogLevel.Error)||this.console.error(e)}}]),e}(),_console="undefined"==typeof console?new NullConsole:console,ALWAYS=new Logger({console:_console,level:LogLevel.Trace}),LOG_LEVEL=LogLevel.Warn,LOGGER=new Logger({console:_console,level:LOG_LEVEL}),alreadyWarned=!1,voidTagNames="area base br col command embed hr img input keygen link meta param source track wbr",voidMap={};forEach(voidTagNames.split(" "),function(e){return voidMap[e]=!0});var GUID=0,proto=Object.create(null,{constructor:{value:void 0,enumerable:!1,writable:!0}});EmptyObject.prototype=proto;var DictSet=function(){function e(){_classCallCheck(this,e),this.dict=dict()}return _createClass(e,[{key:"add",value:function(e){return"string"==typeof e?this.dict[e]=e:this.dict[ensureGuid(e)]=e,this}},{key:"delete",value:function(e){"string"==typeof e?delete this.dict[e]:e._guid&&delete this.dict[e._guid]}},{key:"forEach",value:function(e){var t=this.dict;Object.keys(t).forEach(function(n){return e(t[n])})}},{key:"toArray",value:function(){return Object.keys(this.dict)}}]),e}(),Stack=function(){function e(){_classCallCheck(this,e),this.stack=[],this.current=null}return _createClass(e,[{key:"push",value:function(e){this.current=e,this.stack.push(e)}},{key:"pop",value:function(){var e=this.stack.pop(),t=this.stack.length;return this.current=0===t?null:this.stack[t-1],e}},{key:"isEmpty",value:function(){return 0===this.stack.length}}]),e}(),ListNode=function e(t){_classCallCheck(this,e),this.next=null,this.prev=null,this.value=t},LinkedList=function(){function e(){_classCallCheck(this,e),this.clear()}return _createClass(e,[{key:"head",value:function(){return this._head}},{key:"tail",value:function(){return this._tail}},{key:"clear",value:function(){this._head=this._tail=null}},{key:"isEmpty",value:function(){return null===this._head}},{key:"toArray",value:function(){var e=[];return this.forEachNode(function(t){return e.push(t)}),e}},{key:"splice",value:function(e,t,n){var i=void 0;null===n?(i=this._tail,this._tail=t):(i=n.prev,t.next=n,n.prev=t),i&&(i.next=e,e.prev=i)}},{key:"spliceList",value:function(e,t){e.isEmpty()||this.splice(e.head(),e.tail(),t)}},{key:"nextNode",value:function(e){return e.next}},{key:"prevNode",value:function(e){return e.prev}},{key:"forEachNode",value:function(e){for(var t=this._head;null!==t;)e(t),t=t.next}},{key:"contains",value:function(e){for(var t=this._head;null!==t;){if(t===e)return!0;t=t.next}return!1}},{key:"insertBefore",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return null===t?this.append(e):(t.prev?t.prev.next=e:this._head=e,e.prev=t.prev,e.next=t,t.prev=e,e)}},{key:"append",value:function(e){var t=this._tail;return t?(t.next=e,e.prev=t,e.next=null):this._head=e,this._tail=e}},{key:"pop",value:function(){return this._tail?this.remove(this._tail):null}},{key:"prepend",value:function(e){return this._head?this.insertBefore(e,this._head):this._head=this._tail=e}},{key:"remove",value:function(e){return e.prev?e.prev.next=e.next:this._head=e.next,e.next?e.next.prev=e.prev:this._tail=e.prev,e}}],[{key:"fromSlice",value:function(t){var n=new e;return t.forEachNode(function(e){return n.append(e.clone())}),n}}]),e}(),ListSlice=function(){function e(t,n){_classCallCheck(this,e),this._head=t,this._tail=n}return _createClass(e,[{key:"forEachNode",value:function(e){for(var t=this._head;null!==t;)e(t),t=this.nextNode(t)}},{key:"contains",value:function(e){for(var t=this._head;null!==t;){if(t===e)return!0;t=t.next}return!1}},{key:"head",value:function(){return this._head}},{key:"tail",value:function(){return this._tail}},{key:"toArray",value:function(){var e=[];return this.forEachNode(function(t){return e.push(t)}),e}},{key:"nextNode",value:function(e){return e===this._tail?null:e.next}},{key:"prevNode",value:function(e){return e===this._head?null:e.prev}},{key:"isEmpty",value:function(){return!1}}],[{key:"toList",value:function(e){var t=new LinkedList;return e.forEachNode(function(e){return t.append(e.clone())}),t}}]),e}(),EMPTY_SLICE=new ListSlice(null,null),CONSTANT=0,INITIAL=1,VOLATILE=NaN,RevisionTag=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"validate",value:function(e){return this.value()===e}}]),e}(),$REVISION=INITIAL,DirtyableTag=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?$REVISION:arguments[0];_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.revision=e}return _inherits(t,e),_createClass(t,[{key:"value",value:function(){return this.revision}},{key:"dirty",value:function(){this.revision=++$REVISION}}]),t}(RevisionTag),CachedTag=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.lastChecked=null,this.lastValue=null}return _inherits(t,e),_createClass(t,[{key:"value",value:function(){var e=this.lastChecked,t=this.lastValue;return e!==$REVISION&&(this.lastChecked=$REVISION,this.lastValue=t=this.compute()),this.lastValue}},{key:"invalidate",value:function(){this.lastChecked=null}}]),t}(RevisionTag),TagsPair=function(e){function t(e,n){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.first=e,this.second=n}return _inherits(t,e),_createClass(t,[{key:"compute",value:function(){return Math.max(this.first.value(),this.second.value())}}]),t}(CachedTag),TagsCombinator=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.tags=e}return _inherits(t,e),_createClass(t,[{key:"compute",value:function(){for(var e=this.tags,t=-1,n=0;n<e.length;n++){var i=e[n].value();t=Math.max(i,t)}return t}}]),t}(CachedTag),UpdatableTag=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.tag=e,this.lastUpdated=INITIAL}return _inherits(t,e),_createClass(t,[{key:"compute",value:function(){return Math.max(this.lastUpdated,this.tag.value())}},{key:"update",value:function(e){e!==this.tag&&(this.tag=e,this.lastUpdated=$REVISION,this.invalidate())}}]),t}(CachedTag),CONSTANT_TAG=new(function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"value",value:function(){return CONSTANT}}]),t}(RevisionTag)),VOLATILE_TAG=new(function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"value",value:function(){return VOLATILE}}]),t}(RevisionTag)),CURRENT_TAG=new(function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"value",value:function(){return $REVISION}}]),t}(DirtyableTag)),CachedReference=function(){function e(){_classCallCheck(this,e),this.lastRevision=null,this.lastValue=null}return _createClass(e,[{key:"value",value:function(){var e=this.tag,t=this.lastRevision,n=this.lastValue;return t&&e.validate(t)||(this.lastRevision=e.value(),n=this.lastValue=this.compute()),n}},{key:"invalidate",value:function(){this.lastRevision=null}}]),e}(),MapperReference=function(e){function t(e,n){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.tag=e.tag,this.reference=e,this.mapper=n}return _inherits(t,e),_createClass(t,[{key:"compute",value:function(){var e=this.reference,t=this.mapper;return t(e.value())}}]),t}(CachedReference),ReferenceCache=function(){function e(t){_classCallCheck(this,e),this.lastValue=null,this.lastRevision=null,this.initialized=!1,this.tag=t.tag,this.reference=t}return _createClass(e,[{key:"peek",value:function(){return this.initialized?this.lastValue:this.initialize()}},{key:"revalidate",value:function(){if(!this.initialized)return this.initialize();var e=this.reference,t=this.lastRevision,n=e.tag;if(n.validate(t))return NOT_MODIFIED;this.lastRevision=n.value();var i=this.lastValue,r=e.value();return r===i?NOT_MODIFIED:(this.lastValue=r,r)}},{key:"initialize",value:function(){var e=this.reference,t=this.lastValue=e.value();return this.lastRevision=e.tag.value(),this.initialized=!0,t}}]),e}(),NOT_MODIFIED="adb3b78e-3d22-4e4b-877a-6317c2c5c145",CONST_REFERENCE="503c5a44-e4a9-4bb5-85bc-102d35af6985",ConstReference=function(){function e(t){_classCallCheck(this,e),this.tag=CONSTANT_TAG,this["503c5a44-e4a9-4bb5-85bc-102d35af6985"]=!0,this.inner=t}return _createClass(e,[{key:"value",value:function(){return this.inner}}]),e}(),ListItem=function(e){function t(e,n){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e.valueReferenceFor(n)),this.retained=!1,this.seen=!1,this.key=n.key,this.iterable=e,this.memo=e.memoReferenceFor(n)}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e){this.retained=!0,this.iterable.updateValueReference(this.value,e),this.iterable.updateMemoReference(this.memo,e)}},{key:"shouldRemove",value:function(){return!this.retained}},{key:"reset",value:function(){this.retained=!1,this.seen=!1}}]),t}(ListNode),IterationArtifacts=function(){function e(t){_classCallCheck(this,e),this.map=dict(),this.list=new LinkedList,this.iterable=t}return _createClass(e,[{key:"isEmpty",value:function(){var e=this.iterator=this.iterable.iterate();return e.isEmpty()}},{key:"iterate",value:function(){var e=this.iterator||this.iterable.iterate();return this.iterator=null,e}},{key:"has",value:function(e){return!!this.map[e]}},{key:"get",value:function(e){return this.map[e]}},{key:"wasSeen",value:function(e){var t=this.map[e];return t&&t.seen}},{key:"append",value:function(e){var t=this.map,n=this.list,i=this.iterable,r=t[e.key]=new ListItem(i,e);return n.append(r),r}},{key:"insertBefore",value:function(e,t){var n=this.map,i=this.list,r=this.iterable,a=n[e.key]=new ListItem(r,e);return a.retained=!0,i.insertBefore(a,t),a}},{key:"move",value:function(e,t){var n=this.list;e.retained=!0,n.remove(e),n.insertBefore(e,t)}},{key:"remove",value:function(e){var t=this.list;t.remove(e),delete this.map[e.key]}},{key:"nextNode",value:function(e){return this.list.nextNode(e)}},{key:"head",value:function(){return this.list.head()}}]),e}(),ReferenceIterator=function(){function e(t){_classCallCheck(this,e),this.iterator=null;var n=new IterationArtifacts(t);this.artifacts=n}return _createClass(e,[{key:"next",value:function(){var e=this.artifacts,t=this.iterator=this.iterator||e.iterate(),n=t.next();return n?e.append(n):null}}]),e}(),Phase;!function(e){e[e.Append=0]="Append",e[e.Prune=1]="Prune",e[e.Done=2]="Done"}(Phase||(Phase={}));var IteratorSynchronizer=function(){function e(t){var n=t.target,i=t.artifacts;_classCallCheck(this,e),this.target=n,this.artifacts=i,this.iterator=i.iterate(),this.current=i.head()}return _createClass(e,[{key:"sync",value:function(){for(var e=Phase.Append;;)switch(e){case Phase.Append:e=this.nextAppend();break;case Phase.Prune:e=this.nextPrune();break;case Phase.Done:return void this.nextDone()}}},{key:"advanceToKey",value:function(e){for(var t=this.current,n=this.artifacts,i=t;i&&i.key!==e;)i.seen=!0,i=n.nextNode(i);this.current=i&&n.nextNode(i)}},{key:"nextAppend",value:function(){var e=this.iterator,t=this.current,n=this.artifacts,i=e.next();if(null===i)return this.startPrune();var r=i.key;return t&&t.key===r?this.nextRetain(i):n.has(r)?this.nextMove(i):this.nextInsert(i),Phase.Append}},{key:"nextRetain",value:function(e){var t=this.artifacts,n=this.current;n.update(e),this.current=t.nextNode(n),this.target.retain(e.key,n.value,n.memo)}},{key:"nextMove",value:function(e){var t=this.current,n=this.artifacts,i=this.target,r=e.key,a=n.get(e.key);a.update(e),n.wasSeen(e.key)?(n.move(a,t),i.move(a.key,a.value,a.memo,t?t.key:null)):this.advanceToKey(r)}},{key:"nextInsert",value:function(e){var t=this.artifacts,n=this.target,i=this.current,r=t.insertBefore(e,i);n.insert(r.key,r.value,r.memo,i?i.key:null)}},{key:"startPrune",value:function(){return this.current=this.artifacts.head(),Phase.Prune}},{key:"nextPrune",value:function(){var e=this.artifacts,t=this.target,n=this.current;if(null===n)return Phase.Done;var i=n;return this.current=e.nextNode(i),i.shouldRemove()?(e.remove(i),t.delete(i.key)):i.reset(),Phase.Prune}},{key:"nextDone",value:function(){this.target.done()}}]),e}(),PathReference=function(){function e(t,n){_classCallCheck(this,e),this.cache=EMPTY_CACHE,this.inner=null,this.chains=null,this.lastParentValue=EMPTY_CACHE,this._guid=null,this.tag=VOLATILE_TAG,this.parent=t,this.property=n}return _createClass(e,[{key:"value",value:function(){var e=this.lastParentValue,t=this.property,n=this.inner,i=this._parentValue();if(null===i||void 0===i)return this.cache=void 0;if(e===i)n=this.inner;else{var r="object"==typeof i?Meta.for(i).referenceTypeFor(t):PropertyReference;n=this.inner=new r(i,t,this)}return this.cache=n.value()}},{key:"get",value:function(t){var n=this._getChains();return t in n?n[t]:n[t]=new e(this,t)}},{key:"label",value:function(){return"[reference Direct]"}},{key:"_getChains",value:function(){return this.chains?this.chains:this.chains=dict()}},{key:"_parentValue",value:function(){var e=this.parent.value();return this.lastParentValue=e,e}}]),e}(),RootReference=function(){function e(t){_classCallCheck(this,e),this.chains=dict(),this.tag=VOLATILE_TAG,this.object=t}return _createClass(e,[{key:"value",value:function(){return this.object}},{key:"update",value:function(e){this.object=e}},{key:"get",value:function(e){var t=this.chains;return e in t?t[e]:t[e]=new PathReference(this,e)}},{key:"chainFor",value:function(e){var t=this.chains;return e in t?t[e]:null}},{key:"path",value:function(e){return e.split(".").reduce(function(e,t){return e.get(intern(t))},this)}},{key:"referenceFromParts",value:function(e){return e.reduce(function(e,t){return e.get(t)},this)}},{key:"label",value:function(){return"[reference Root]"}}]),e}(),NOOP_DESTROY={destroy:function(){}},ConstPath=function(){function e(t,n){_classCallCheck(this,e),this.tag=VOLATILE_TAG,this.parent=t}return _createClass(e,[{key:"chain",value:function(){return NOOP_DESTROY}},{key:"notify",value:function(){}},{key:"value",value:function(){return this.parent[this.property]}},{key:"get",value:function(t){return new e(this.parent[this.property],t)}}]),e}(),ConstRoot=function(){function e(t){_classCallCheck(this,e),this.tag=VOLATILE_TAG,this.inner=t}return _createClass(e,[{key:"update",value:function(e){this.inner=e}},{key:"chain",value:function(){return NOOP_DESTROY}},{key:"notify",value:function(){}},{key:"value",value:function(){return this.inner}},{key:"referenceFromParts",value:function(e){throw new Error("Not implemented")}},{key:"chainFor",value:function(e){throw new Error("Not implemented")}},{key:"get",value:function(e){return new ConstPath(this.inner,e)}}]),e}(),ConstMeta=function(){function e(t){_classCallCheck(this,e),this.object=t}return _createClass(e,[{key:"root",value:function(){return new ConstRoot(this.object)}}]),e}(),CLASS_META="df8be4c8-4e89-44e2-a8f9-550c8dacdca7",hasOwnProperty=Object.hasOwnProperty,Meta=function(){function e(t,n){var i=n.RootReferenceFactory,r=n.DefaultPathReferenceFactory;_classCallCheck(this,e),this.references=null,this.slots=null,this.referenceTypes=null,this.propertyMetadata=null,this.object=t,this.RootReferenceFactory=i||RootReference,this.DefaultPathReferenceFactory=r||PropertyReference}return _createClass(e,[{key:"addReference",value:function(e,t){var n=this.references=this.references||dict(),i=n[e]=n[e]||new DictSet;i.add(t)}},{key:"addReferenceTypeFor",value:function(e,t){this.referenceTypes=this.referenceTypes||dict(),this.referenceTypes[e]=t}},{key:"referenceTypeFor",value:function(e){return this.referenceTypes?this.referenceTypes[e]||PropertyReference:PropertyReference}},{key:"removeReference",value:function(e,t){if(this.references){var n=this.references[e];n.delete(t)}}},{key:"getReferenceTypes",value:function(){return this.referenceTypes=this.referenceTypes||dict(),this.referenceTypes}},{key:"referencesFor",value:function(e){if(this.references)return this.references[e]}},{key:"getSlots",value:function(){return this.slots=this.slots||dict()}},{key:"root",value:function(){return this.rootCache=this.rootCache||new this.RootReferenceFactory(this.object)}}],[{key:"for",value:function(t){if(null===t||void 0===t)return new e(t,{});if(hasOwnProperty.call(t,"_meta")&&t._meta)return t._meta;if(!Object.isExtensible(t))return new ConstMeta(t);var n=e;if(t.constructor&&t.constructor[CLASS_META]){var i=t.constructor[CLASS_META];n=i.InstanceMetaConstructor}else t[CLASS_META]&&(n=t[CLASS_META].InstanceMetaConstructor);return t._meta=new n(t,{})}},{key:"exists",value:function(e){return"object"==typeof e&&e._meta}},{key:"metadataForProperty",value:function(e){return null}}]),e}(),PropertyReference=function(){function e(t,n,i){_classCallCheck(this,e),this.tag=VOLATILE_TAG,this.object=t,this.property=n}return _createClass(e,[{key:"value",value:function(){return this.object[this.property]}},{key:"label",value:function(){return"[reference Property]"}}]),e}(),PrettyPrint=function e(t,n){var i=arguments.length<=2||void 0===arguments[2]?null:arguments[2],r=arguments.length<=3||void 0===arguments[3]?null:arguments[3],a=arguments.length<=4||void 0===arguments[4]?null:arguments[4];_classCallCheck(this,e),this.type=t,this.operation=n,this.params=i,this.hash=r,this.templates=a},StatementSyntax=function(){function e(){_classCallCheck(this,e),this.next=null,this.prev=null}return _createClass(e,[{key:"prettyPrint",value:function(){return new PrettyPrint(this.type,this.type)}},{key:"clone",value:function(){return new this.constructor(this)}},{key:"scan",value:function(e){return this}}],[{key:"fromSpec",value:function(e,t){throw new Error("You need to implement fromSpec on "+this)}}]),e}(),ExpressionSyntax=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"prettyPrint",value:function(){return""+this.type}}],[{key:"fromSpec",value:function(e,t){throw new Error("You need to implement fromSpec on "+this)}}]),e}(),ATTRIBUTE_SYNTAX="e1185d30-7cac-4b12-b26a-35327d905d92",AttributeSyntax=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this["e1185d30-7cac-4b12-b26a-35327d905d92"]=!0}return _inherits(t,e),t}(StatementSyntax),Cursor=function e(t,n){_classCallCheck(this,e),this.element=t,this.nextSibling=n},ConcreteBounds=function(){function e(t,n,i){_classCallCheck(this,e),this.parentNode=t,this.first=n,this.last=i}return _createClass(e,[{key:"parentElement",value:function(){return this.parentNode}},{key:"firstNode",value:function(){return this.first}},{key:"lastNode",value:function(){return this.last}}]),e}(),SingleNodeBounds=function(){function e(t,n){_classCallCheck(this,e),this.parentNode=t,this.node=n}return _createClass(e,[{key:"parentElement",value:function(){return this.parentNode}},{key:"firstNode",value:function(){return this.node}},{key:"lastNode",value:function(){return this.node}}]),e}(),AbstractOpcode=function(){function e(){_classCallCheck(this,e),initializeGuid(this)}return _createClass(e,[{key:"toJSON",value:function(){return{guid:this._guid,type:this.type}}}]),e}(),Opcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.next=null,this.prev=null}return _inherits(t,e),t}(AbstractOpcode),UpdatingOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.next=null,this.prev=null}return _inherits(t,e),t}(AbstractOpcode),PrimitiveReference=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"get",value:function(){return UNDEFINED_REFERENCE}}]),t}(ConstReference),ConditionalReference=function(){function e(t){_classCallCheck(this,e),this.inner=t,this.tag=t.tag}return _createClass(e,[{key:"value",value:function(){return this.toBool(this.inner.value())}},{key:"toBool",value:function(e){return!!e}}]),e}(),NULL_REFERENCE=new PrimitiveReference(null),UNDEFINED_REFERENCE=new PrimitiveReference(void 0),CompiledExpression=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"toJSON",value:function(){return"UNIMPL: "+this.type.toUpperCase()}}]),e}(),CompiledValue=function(e){function t(e){var n=e.value;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="value",this.reference=new ValueReference(n)}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){return this.reference}},{key:"toJSON",value:function(){return JSON.stringify(this.reference.value())}}]),t}(CompiledExpression),ValueReference=function(e){function t(){
_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.children=dict()}return _inherits(t,e),_createClass(t,[{key:"get",value:function(e){var n=this.children,i=n[e];return i||(i=n[e]=new t(this.inner[e])),i}},{key:"value",value:function(){return this.inner}}]),t}(ConstReference),TextOpcode=function(e){function t(e){var n=e.text;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="text",this.text=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.stack().appendText(this.text)}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:[JSON.stringify(this.text)]}}}]),t}(Opcode),OpenPrimitiveElementOpcode=function(e){function t(e){var n=e.tag;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="open-primitive-element",this.tag=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.stack().openElement(this.tag)}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:[JSON.stringify(this.tag)]}}}]),t}(Opcode),OpenDynamicPrimitiveElementOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="open-dynamic-primitive-element"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=e.frame.getOperand().value();e.stack().openElement(t)}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:["$OPERAND"]}}}]),t}(Opcode),ClassList=function(){function e(){_classCallCheck(this,e),this.list=null,this.isConst=!0}return _createClass(e,[{key:"append",value:function(e){var t=this.list,n=this.isConst;null===t&&(t=this.list=[]),t.push(e),this.isConst=n&&isConst(e)}},{key:"toReference",value:function(){var e=this.list,t=this.isConst;return e?t?new ValueReference(toClassName(e)):new ClassListReference(e):NULL_REFERENCE}}]),e}(),ClassListReference=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.list=[],this.tag=combineTagged(e),this.list=e}return _inherits(t,e),_createClass(t,[{key:"compute",value:function(){return toClassName(this.list)}}]),t}(CachedReference),CloseElementOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="close-element"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){for(var t=e.env.getDOM(),n=e.stack(),i=n.element,r=n.elementOperations.groups,a=new ClassList,s=dict(),o=[],l=0;l<r.length;l++)for(var c=0;c<r[l].length;c++){var u=r[l][c],h=u.name,p=u.reference;"class"===h?a.append(p):s[h]||(o.push(h),s[h]=u)}var f=a.toReference();isConst(f)?NonNamespacedAttribute.install(t,i,"class",f.value()):e.updateWith(new NonNamespacedAttribute(i,"class",f).flush(t));for(var d=0;d<o.length;d++){var y=s[o[d]].flush(t,i);y&&e.updateWith(y)}n.closeElement()}}]),t}(Opcode),StaticAttrOpcode=function(e){function t(e){var n=e.namespace,i=e.name,r=e.value;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="static-attr",this.namespace=n,this.name=i,this.value=new ValueReference(r)}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.name,n=this.value,i=this.namespace;i?e.stack().setAttributeNS(i,t,n):e.stack().setAttribute(t,n)}},{key:"toJSON",value:function(){var e=this._guid,t=this.type,n=this.namespace,i=this.name,r=this.value,a=dict();return n&&(a.namespace=JSON.stringify(n)),a.name=JSON.stringify(i),a.value=JSON.stringify(r.value()),{guid:e,type:t,details:a}}}]),t}(Opcode),ModifierOpcode=function(e){function t(e){var n=e.name,i=e.manager,r=e.args;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="modifier",this.name=n,this.manager=i,this.args=r}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.manager,n=e.stack(),i=n.element,r=n.dom,a=this.args.evaluate(e),s=e.dynamicScope(),o=t.install(i,a,r,s),l=t.getDestructor(o);l&&e.newDestroyable(l),e.updateWith(new UpdateModifierOpcode({manager:t,modifier:o,element:i,dynamicScope:s,args:a}))}},{key:"toJSON",value:function(){var e=this._guid,t=this.type,n=this.name,i=this.args,r=dict();return r.type=JSON.stringify(t),r.name=JSON.stringify(n),r.args=JSON.stringify(i),{guid:e,type:t,details:r}}}]),t}(Opcode),UpdateModifierOpcode=function(e){function t(e){var n=e.manager,i=e.modifier,r=e.element,a=e.dynamicScope,s=e.args;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="update-modifier",this.modifier=i,this.manager=n,this.element=r,this.dynamicScope=a,this.args=s,this.tag=s.tag,this.lastUpdated=s.tag.value()}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.manager,n=this.modifier,i=this.element,r=this.dynamicScope,a=this.args,s=this.lastUpdated;a.tag.validate(s)||(t.update(n,i,a,e.dom,r),this.lastUpdated=a.tag.value())}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:[JSON.stringify(this.args)]}}}]),t}(UpdatingOpcode),ElementPatchOperation=function(){function e(t,n){_classCallCheck(this,e),this.cache=null,this.tag=n.tag,this.element=t,this.reference=n}return _createClass(e,[{key:"flush",value:function(e){var t=this.reference,n=this.element;if(!isConst(t)){var i=this.cache=new ReferenceCache(t),r=i.peek();return this.install(e,n,r),new PatchElementOpcode(this)}var r=t.value();this.install(e,n,r)}},{key:"patch",value:function(e){var t=this.element,n=this.cache,i=n.revalidate();isModified(i)&&this.update(e,t,i)}}]),e}(),NamespacedAttribute=function(e){function t(e,n,i,r){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,r),this.element=e,this.namespace=n,this.name=i,this.reference=r}return _inherits(t,e),_createClass(t,[{key:"install",value:function(e,n,i){var r=this.namespace,a=this.name;t.install(e,n,r,a,i)}},{key:"update",value:function(e,n,i){var r=this.namespace,a=this.name;t.update(e,n,r,a,i)}},{key:"toJSON",value:function(){var e=this.element,t=this.namespace,n=this.name,i=this.cache;return{element:formatElement(e),type:"attribute",namespace:t,name:n,lastValue:i.peek()}}}],[{key:"install",value:function(e,t,n,i,r){null!==r&&e.setAttributeNS(t,n,i,r)}},{key:"update",value:function(e,t,n,i,r){null===r?e.removeAttributeNS(t,n,i):e.setAttributeNS(t,n,i,r)}}]),t}(ElementPatchOperation),NonNamespacedAttribute=function(e){function t(e,n,i){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i),this.name=n}return _inherits(t,e),_createClass(t,[{key:"install",value:function(e,n,i){var r=this.name;t.install(e,n,r,i)}},{key:"update",value:function(e,n,i){var r=this.name;t.update(e,n,r,i)}},{key:"toJSON",value:function(){var e=this.element,t=this.name,n=this.cache;return{element:formatElement(e),type:"attribute",name:t,lastValue:n.peek()}}}],[{key:"install",value:function(e,t,n,i){null!==i&&e.setAttribute(t,n,i)}},{key:"update",value:function(e,t,n,i){null===i?e.removeAttribute(t,n):e.setAttribute(t,n,i)}}]),t}(ElementPatchOperation),Property=function(e){function t(e,n,i){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i),this.name=n}return _inherits(t,e),_createClass(t,[{key:"install",value:function(e,n,i){var r=this.name;t.set(e,n,r,i)}},{key:"update",value:function(e,n,i){var r=this.name;t.set(e,n,r,i)}},{key:"toJSON",value:function(){var e=this.element,t=this.name,n=this.cache;return{element:formatElement(e),type:"property",name:t,lastValue:JSON.stringify(n.peek())}}}],[{key:"set",value:function(e,t,n,i){e.setProperty(t,n,i)}}]),t}(ElementPatchOperation),EmptyStringResetingProperty=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"install",value:function(e,n,i){this.name;null===i&&(i=""),_get(Object.getPrototypeOf(t.prototype),"install",this).call(this,e,n,i)}},{key:"update",value:function(e,n,i){null===i&&(i=""),_get(Object.getPrototypeOf(t.prototype),"update",this).call(this,e,n,i)}}]),t}(Property),DynamicAttrNSOpcode=function(e){function t(e){var n=e.name,i=e.namespace;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="dynamic-attr",this.name=n,this.namespace=i}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.name,n=this.namespace,i=e.frame.getOperand();e.stack().setAttributeNS(n,t,i)}},{key:"toJSON",value:function(){var e=this._guid,t=this.type,n=this.name,i=this.namespace,r=dict();return r.name=JSON.stringify(n),r.value="$OPERAND",i&&(r.namespace=JSON.stringify(i)),{guid:e,type:t,details:r}}}]),t}(Opcode),DynamicAttrOpcode=function(e){function t(e){var n=e.name;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="dynamic-attr",this.name=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.name,n=e.frame.getOperand();e.stack().setAttribute(t,n)}},{key:"toJSON",value:function(){var e=this._guid,t=this.type,n=this.name,i=dict();return i.name=JSON.stringify(n),i.value="$OPERAND",{guid:e,type:t,details:i}}}]),t}(Opcode),DynamicPropOpcode=function(e){function t(e){var n=e.name;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="dynamic-prop",this.name=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.name,n=e.frame.getOperand();e.stack().setProperty(t,n)}},{key:"toJSON",value:function(){var e=this._guid,t=this.type,n=this.name,i=dict();return i.name=JSON.stringify(n),i.value="$OPERAND",{guid:e,type:t,details:i}}}]),t}(Opcode),PatchElementOpcode=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="patch-element",this.tag=e.tag,this.operation=e}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){this.operation.patch(e.env.getDOM())}},{key:"toJSON",value:function(){var e=this._guid,t=this.type,n=this.operation;return{guid:e,type:t,details:n.toJSON()}}}]),t}(UpdatingOpcode),CommentOpcode=function(e){function t(e){var n=e.comment;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="comment",this.comment=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.stack().appendComment(this.comment)}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:[JSON.stringify(this.comment)]}}}]),t}(Opcode),First=function(){function e(t){_classCallCheck(this,e),this.node=t}return _createClass(e,[{key:"firstNode",value:function(){return this.node}}]),e}(),Last=function(){function e(t){_classCallCheck(this,e),this.node=t}return _createClass(e,[{key:"lastNode",value:function(){return this.node}}]),e}(),GroupedElementOperations=function(){function e(t){_classCallCheck(this,e),this.element=t;var n=this.group=[];this.groups=[n]}return _createClass(e,[{key:"startGroup",value:function(){var e=this.group=[];this.groups.push(e)}},{key:"addAttribute",value:function(e,t){"INPUT"===this.element.tagName&&"value"===e&&this.group.push(new EmptyStringResetingProperty(this.element,e,t)),this.group.push(new NonNamespacedAttribute(this.element,e,t))}},{key:"addAttributeNS",value:function(e,t,n){this.group.push(new NamespacedAttribute(this.element,e,t,n))}},{key:"addProperty",value:function(e,t){this.group.push(new Property(this.element,e,t))}}]),e}(),Fragment=function(){function e(t){_classCallCheck(this,e),this.bounds=t}return _createClass(e,[{key:"parentElement",value:function(){return this.bounds.parentElement()}},{key:"firstNode",value:function(){return this.bounds.firstNode()}},{key:"lastNode",value:function(){return this.bounds.lastNode()}},{key:"update",value:function(e){this.bounds=e}}]),e}(),ElementStack=function(){function e(t){var n=t.dom,i=t.parentNode,r=t.nextSibling;_classCallCheck(this,e),this.elementOperations=null,this.elementStack=new Stack,this.nextSiblingStack=new Stack,this.elementOperationsStack=new Stack,this.blockStack=new Stack,this.dom=n,this.element=i,this.nextSibling=r,this.elementStack.push(this.element),this.nextSiblingStack.push(this.nextSibling)}return _createClass(e,[{key:"block",value:function(){return this.blockStack.current}},{key:"pushElement",value:function(e){var t=this.dom.createElement(e,this.element),n=new GroupedElementOperations(t);return this.elementOperations=n,this.element=t,this.nextSibling=null,this.elementStack.push(t),this.elementOperationsStack.push(n),this.nextSiblingStack.push(null),t}},{key:"popElement",value:function(){var e=this.elementStack,t=this.nextSiblingStack,n=this.elementOperationsStack,i=e.pop();return t.pop(),n.pop(),this.element=e.current,this.nextSibling=t.current,this.elementOperations=n.current,i}},{key:"pushBlock",value:function(){var e=new BlockTracker(this.element);return this.pushBlockTracker(e),e}},{key:"pushBlockTracker",value:function(e){var t=this.blockStack.current;return null!==t&&(t.newDestroyable(e),t.newBounds(e)),this.blockStack.push(e),e}},{key:"pushBlockList",value:function(e){var t=new BlockListTracker(this.element,e),n=this.blockStack.current;return null!==n&&(n.newDestroyable(t),n.newBounds(t)),this.blockStack.push(t),t}},{key:"popBlock",value:function(){return this.blockStack.current.finalize(this),this.blockStack.pop()}},{key:"openElement",value:function(e){var t=this.pushElement(e);return this.blockStack.current.openElement(t),t}},{key:"newDestroyable",value:function(e){this.blockStack.current.newDestroyable(e)}},{key:"newBounds",value:function(e){this.blockStack.current.newBounds(e)}},{key:"appendText",value:function(e){var t=this.dom,n=t.createTextNode(e);return t.insertBefore(this.element,n,this.nextSibling),this.blockStack.current.newNode(n),n}},{key:"appendComment",value:function(e){var t=this.dom,n=t.createComment(e);return t.insertBefore(this.element,n,this.nextSibling),this.blockStack.current.newNode(n),n}},{key:"setAttribute",value:function(e,t){this.elementOperations.addAttribute(e,t)}},{key:"setAttributeNS",value:function(e,t,n){this.elementOperations.addAttributeNS(e,t,n)}},{key:"setProperty",value:function(e,t){this.elementOperations.addProperty(e,t)}},{key:"closeElement",value:function(){this.blockStack.current.closeElement();var e=this.popElement();this.dom.insertBefore(this.element,e,this.nextSibling)}}],[{key:"forInitialRender",value:function(t){var n=t.parentNode,i=t.nextSibling,r=t.dom;return new e({dom:r,parentNode:n,nextSibling:i})}},{key:"resume",value:function(t){var n=t.tracker,i=t.nextSibling,r=t.dom,a=n.parentElement(),s=new e({dom:r,parentNode:a,nextSibling:i});return s.pushBlockTracker(n),s}}]),e}(),BlockTracker=function(){function e(t){_classCallCheck(this,e),this.first=null,this.last=null,this.destroyables=null,this.nesting=0,this.parent=t}return _createClass(e,[{key:"destroy",value:function(){var e=this.destroyables;if(e&&e.length)for(var t=0;t<e.length;t++)e[t].destroy()}},{key:"parentElement",value:function(){return this.parent}},{key:"firstNode",value:function(){return this.first&&this.first.firstNode()}},{key:"lastNode",value:function(){return this.last&&this.last.lastNode()}},{key:"openElement",value:function(e){this.newNode(e),this.nesting++}},{key:"closeElement",value:function(){this.nesting--}},{key:"newNode",value:function(e){0===this.nesting&&(this.first||(this.first=new First(e)),this.last=new Last(e))}},{key:"newBounds",value:function(e){0===this.nesting&&(this.first||(this.first=e),this.last=e)}},{key:"newDestroyable",value:function(e){this.destroyables=this.destroyables||[],this.destroyables.push(e)}},{key:"finalize",value:function(e){this.first||e.appendComment("")}},{key:"reset",value:function(e){var t=this.destroyables;if(t&&t.length)for(var n=0;n<t.length;n++)e.didDestroy(t[n]);var i=clear(this);return this.destroyables=null,this.first=null,this.last=null,i}}]),e}(),BlockListTracker=function(){function e(t,n){_classCallCheck(this,e),this.parent=t,this.boundList=n}return _createClass(e,[{key:"destroy",value:function(){this.boundList.forEachNode(function(e){return e.destroy()})}},{key:"parentElement",value:function(){return this.parent}},{key:"firstNode",value:function(){return this.boundList.head().firstNode()}},{key:"lastNode",value:function(){return this.boundList.tail().lastNode()}},{key:"openElement",value:function(e){debugAssert(!1,"Cannot openElement directly inside a block list")}},{key:"closeElement",value:function(){debugAssert(!1,"Cannot closeElement directly inside a block list")}},{key:"newNode",value:function(e){debugAssert(!1,"Cannot create a new node directly inside a block list")}},{key:"newBounds",value:function(e){}},{key:"newDestroyable",value:function(e){}},{key:"finalize",value:function(e){}},{key:"reset",value:function(){}}]),e}(),CompiledPositionalArgs=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(e){var t=e.values;return t.length?new CompiledNonEmptyPositionalArgs({values:t}):COMPILED_EMPTY_POSITIONAL_ARGS}}]),e}(),CompiledNonEmptyPositionalArgs=function(e){function t(e){var n=e.values;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="positional-args",this.length=n.length,this.values=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){for(var t=this.values,n=new Array(t.length),i=0;i<t.length;i++)n[i]=t[i].evaluate(e);return EvaluatedPositionalArgs.create({values:n})}},{key:"toJSON",value:function(){return"["+this.values.map(function(e){return e.toJSON()}).join(", ")+"]"}}]),t}(CompiledPositionalArgs),COMPILED_EMPTY_POSITIONAL_ARGS=new(function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="empty-positional-args",this.length=0}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){return EvaluatedPositionalArgs.empty()}},{key:"toJSON",value:function(){return"<EMPTY>"}}]),t}(CompiledPositionalArgs)),EvaluatedPositionalArgs=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"forEach",value:function(e){for(var t=this.values,n=0;n<t.length;n++)e(t[n])}}],[{key:"empty",value:function(){return EVALUATED_EMPTY_POSITIONAL_ARGS}},{key:"create",value:function(e){var t=e.values;return new NonEmptyEvaluatedPositionalArgs({values:t})}}]),e}(),NonEmptyEvaluatedPositionalArgs=function(e){function t(e){var n=e.values;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.tag=combineTagged(n),this.length=n.length,this.values=n}return _inherits(t,e),_createClass(t,[{key:"at",value:function(e){return this.values[e]}},{key:"value",value:function(){for(var e=new Array(this.values.length),t=0;t<this.values.length;t++)e[t]=this.values[t].value();return e}}]),t}(EvaluatedPositionalArgs),EVALUATED_EMPTY_POSITIONAL_ARGS=new(function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.tag=CONSTANT_TAG,this.length=0,this.values=[]}return _inherits(t,e),_createClass(t,[{key:"at",value:function(){return NULL_REFERENCE}},{key:"value",value:function(){return[]}}]),t}(EvaluatedPositionalArgs)),CompiledNamedArgs=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(e){var t=e.map;return Object.keys(t).length?new CompiledNonEmptyNamedArgs({map:t}):COMPILED_EMPTY_NAMED_ARGS}}]),e}(),CompiledNonEmptyNamedArgs=function(e){function t(e){var n=e.map;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="named-args",this.map=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){for(var t=this.map,n=dict(),i=Object.keys(t),r=0;r<i.length;r++){var a=i[r];n[a]=t[a].evaluate(e)}return EvaluatedNamedArgs.create({map:n})}},{key:"toJSON",value:function(){var e=this.map,t=Object.keys(e).map(function(t){return t+": "+e[t].toJSON()}).join(", ");return"{"+t+"}"}}]),t}(CompiledNamedArgs),COMPILED_EMPTY_NAMED_ARGS=new(function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="empty-named-args",this.map=dict()}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){return EvaluatedNamedArgs.empty()}},{key:"toJSON",value:function(){return"<EMPTY>"}}]),t}(CompiledNamedArgs)),EvaluatedNamedArgs=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"forEach",value:function(e){for(var t=this.map,n=Object.keys(t),i=0;i<n.length;i++){var r=n[i];e(r,t[r])}}}],[{key:"empty",value:function(){return EVALUATED_EMPTY_NAMED_ARGS}},{key:"create",value:function(e){var t=e.map;return new NonEmptyEvaluatedNamedArgs({map:t})}}]),e}(),NonEmptyEvaluatedNamedArgs=function(e){function t(e){var n=e.map;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var i=this.keys=Object.keys(n);this.map=n;for(var r=[],a=0;a<i.length;a++){var s=i[a];r.push(n[s].tag)}this.tag=combine(r)}return _inherits(t,e),_createClass(t,[{key:"get",value:function(e){return this.map[e]||UNDEFINED_REFERENCE}},{key:"has",value:function(e){return!!this.map[e]}},{key:"value",value:function(){for(var e=this.map,t=this.keys,n=dict(),i=0;i<t.length;i++){var r=t[i];n[r]=e[r].value()}return n}}]),t}(EvaluatedNamedArgs),EVALUATED_EMPTY_NAMED_ARGS=new(function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.tag=CONSTANT_TAG,this.keys=[]}return _inherits(t,e),_createClass(t,[{key:"get",value:function(){return UNDEFINED_REFERENCE}},{key:"has",value:function(e){return!1}},{key:"value",value:function(){return{}}}]),t}(EvaluatedNamedArgs)),CompiledArgs=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(e){var t=e.positional,n=e.named;return t===COMPILED_EMPTY_POSITIONAL_ARGS&&n===COMPILED_EMPTY_NAMED_ARGS?COMPILED_EMPTY_ARGS:new CompiledNonEmptyArgs({positional:t,named:n})}},{key:"empty",value:function(){return COMPILED_EMPTY_ARGS}}]),e}(),CompiledNonEmptyArgs=function(e){function t(e){var n=e.positional,i=e.named;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="args",this.positional=n,this.named=i}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){return EvaluatedArgs.create({positional:this.positional.evaluate(e),named:this.named.evaluate(e)})}}]),t}(CompiledArgs),COMPILED_EMPTY_ARGS=new(function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="empty-args"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){return EvaluatedArgs.empty()}}]),t}(CompiledArgs)),EvaluatedArgs=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"withInternal",value:function(){return this.internal||(this.internal=dict()),this}}],[{key:"empty",value:function(){return EMPTY_EVALUATED_ARGS}},{key:"create",value:function(e){return new NonEmptyEvaluatedArgs(e)}},{key:"positional",value:function(e){return new NonEmptyEvaluatedArgs({positional:EvaluatedPositionalArgs.create({values:e}),named:EvaluatedNamedArgs.empty()})}}]),e}(),NonEmptyEvaluatedArgs=function(e){function t(e){var n=e.positional,i=e.named;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.tag=combine([n.tag,i.tag]),this.positional=n,this.named=i,this.internal=null}return _inherits(t,e),t}(EvaluatedArgs),EMPTY_EVALUATED_ARGS=new(function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.tag=CONSTANT_TAG,this.positional=EVALUATED_EMPTY_POSITIONAL_ARGS,this.named=EVALUATED_EMPTY_NAMED_ARGS,this.internal=null}return _inherits(t,e),_createClass(t,[{key:"withInternal",value:function(){var e=new NonEmptyEvaluatedArgs(this);return e.internal=dict(),e}}]),t}(EvaluatedArgs)),KEY=intern("__glimmer"+ +new Date),SerializedExpressions;!function(e){function t(e){return null!==e&&"object"!=typeof e}e.isUnknown=is("unknown"),e.isAttr=is("attr"),e.isGet=is("get"),e.isConcat=is("concat"),e.isHelper=is("helper"),e.isHasBlock=is("hasBlock"),e.isHasBlockParams=is("hasBlockParams"),e.isValue=t}(SerializedExpressions||(SerializedExpressions={}));var Statements;!function(e){e.isText=is("text"),e.isAppend=is("append"),e.isComment=is("comment"),e.isModifier=is("modifier"),e.isBlock=is("block"),e.isOpenElement=is("openElement"),e.isCloseElement=is("closeElement"),e.isStaticAttr=is("staticAttr"),e.isDynamicAttr=is("dynamicAttr"),e.isDynamicProp=is("dynamicProp"),e.isYield=is("yield")}(Statements||(Statements={}));var _Statements=Statements,isYield=_Statements.isYield,isBlock=_Statements.isBlock,isAppend=_Statements.isAppend,isDynamicAttr=_Statements.isDynamicAttr,isDynamicProp=_Statements.isDynamicProp,isText=_Statements.isText,isComment=_Statements.isComment,isOpenElement=_Statements.isOpenElement,isCloseElement=_Statements.isCloseElement,isStaticAttr=_Statements.isStaticAttr,isModifier=_Statements.isModifier,SymbolTable=function(){function e(t,n){_classCallCheck(this,e),this.locals=dict(),this.named=dict(),this.yields=dict(),this.size=1,this.parent=t,this.top=t?t.top:this,this.template=n}return _createClass(e,[{key:"initEntryPoint",value:function(e){return this}},{key:"initBlock",value:function(e){var t=e.locals;return this.initPositionals(t),this}},{key:"initLayout",value:function(e){var t=e.named,n=e.yields;return this.initNamed(t),this.initYields(n),this}},{key:"initPositionals",value:function(e){var t=this;return e&&e.forEach(function(e){return t.locals[e]=t.top.size++}),this}},{key:"initNamed",value:function(e){var t=this;return e&&e.forEach(function(e){return t.named[e]=t.top.size++}),this}},{key:"initYields",value:function(e){var t=this;return e&&e.forEach(function(e){return t.yields[e]=t.top.size++}),this}},{key:"getYield",value:function(e){var t=this.yields,n=this.parent,i=t[e];return!i&&n&&(i=n.getYield(e)),i}},{key:"getNamed",value:function(e){var t=this.named,n=this.parent,i=t[e];return!i&&n&&(i=n.getNamed(e)),i}},{key:"getLocal",value:function(e){var t=this.locals,n=this.parent,i=t[e];return!i&&n&&(i=n.getLocal(e)),i}},{key:"isTop",value:function(){return this.top===this}}],[{key:"initForEntryPoint",value:function(t){return t.symbolTable=new e(null,t).initEntryPoint(t)}},{key:"initForLayout",value:function(t){return t.symbolTable=new e(null,t).initLayout(t)}},{key:"initForBlock",value:function(t){var n=t.parent,i=t.block;return i.symbolTable=new e(n,i).initBlock(i)}}]),e}(),PutDynamicComponentDefinitionOpcode=function(e){function t(e){var n=e.args;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="put-dynamic-component-definition",this.args=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=e.frame.getOperand(),n=isConst(t)?void 0:new ReferenceCache(t),i=n?n.peek():t.value(),r=this.args.evaluate(e).withInternal();e.frame.setArgs(r),r.internal.definition=i,n&&e.updateWith(new Assert(n))}}]),t}(Opcode),PutComponentDefinitionOpcode=function(e){function t(e){var n=e.args,i=e.definition;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="put-component-definition",this.args=n,this.definition=i}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.args.evaluate(e).withInternal();t.internal.definition=this.definition,e.frame.setArgs(t)}}]),t}(Opcode),OpenComponentOpcode=function(e){function t(e){var n=e.shadow,i=e.templates;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="open-component",this.shadow=n,this.templates=i}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.shadow,n=this.templates,i=e.frame.getArgs(),r=i.internal.definition;e.pushDynamicScope();var a=e.dynamicScope(),s=r.manager,o=n&&!!n.default,l=s.create(r,i,a,o),c=s.getDestructor(l);c&&e.newDestroyable(c),i.internal.component=l,i.internal.definition=r=s.ensureCompilable(r,l,e.env),i.internal.shadow=t,e.beginCacheGroup();var u=layoutFor(r,e.env),h=e.scope(),p=s.getSelf(l);e.pushRootScope(p,u.symbols),e.invokeLayout({templates:n,args:i,shadow:t,layout:u,callerScope:h}),e.env.didCreate(l,s),e.updateWith(new UpdateComponentOpcode({name:r.name,component:l,manager:s,args:i,dynamicScope:a}))}}]),t}(Opcode),UpdateComponentOpcode=function(e){function t(e){var n=e.name,i=e.component,r=e.manager,a=e.args,s=e.dynamicScope;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="update-component";var o=void 0,l=r.getTag(i);o=l?this.tag=combine([a.tag,l]):this.tag=a.tag,this.name=n,this.component=i,this.manager=r,this.args=a,this.dynamicScope=s,this.lastUpdated=o.value()}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.component,n=this.manager,i=this.tag,r=this.args,a=this.dynamicScope,s=this.lastUpdated;i.validate(s)||(n.update(t,r,a),e.env.didUpdate(t,n),this.lastUpdated=i.value())}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:[JSON.stringify(this.name)]}}}]),t}(UpdatingOpcode),DidCreateElementOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="did-create-element"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=e.frame.getArgs(),n=t.internal,i=n.definition,r=i.manager,a=n.component;r.didCreateElement(a,e.stack().element,e.stack().elementOperations)}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:["$ARGS"]}}}]),t}(Opcode),ShadowAttributesOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="shadow-attributes"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=e.frame.getArgs(),n=t.internal,i=n.shadow,r=t.named;i&&i.forEach(function(t){e.stack().setAttribute(t,r.get(t))})}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:["$ARGS"]}}}]),t}(Opcode),CloseComponentOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="close-component"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.popScope(),e.popDynamicScope(),e.commitCacheGroup()}}]),t}(Opcode),FunctionExpressionSyntax=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.func=e}return _inherits(t,e),_createClass(t,[{key:"compile",value:function(){return new CompiledFunctionExpression(this.func)}}]),t}(ExpressionSyntax),CompiledFunctionExpression=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="function",this.func=e}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.func;return t(e)}},{key:"toJSON",value:function(){var e=this.func;return e.name?"`"+e.name+"(...)`":"`func(...)`"}}]),t}(CompiledExpression),CACHED_LAYOUT="CACHED_LAYOUT [d990e194-8529-4f3b-8ee9-11c58a70f7a4]",IComponentDefinition=function e(t,n,i){_classCallCheck(this,e),this["CACHED_LAYOUT [d990e194-8529-4f3b-8ee9-11c58a70f7a4]"]=null,this.name=t,this.manager=n,
this.ComponentClass=i},Compiler=function(){function e(t,n){_classCallCheck(this,e),this.block=t,this.current=t.program.head(),this.env=n,this.symbolTable=t.symbolTable}return _createClass(e,[{key:"compileStatement",value:function(e,t){this.env.statement(e).compile(t,this.env,this.symbolTable)}}]),e}(),EntryPointCompiler=function(e){function t(e,n){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n),this.ops=new CompileIntoList(n,e.symbolTable)}return _inherits(t,e),_createClass(t,[{key:"compile",value:function(){for(var e=this.block,t=this.ops,n=e.program,i=n.head();i;){var r=n.nextNode(i);this.compileStatement(i,t),i=r}return t.toOpSeq()}},{key:"append",value:function(e){this.ops.append(e)}},{key:"getLocalSymbol",value:function(e){return this.symbolTable.getLocal(e)}},{key:"getNamedSymbol",value:function(e){return this.symbolTable.getNamed(e)}},{key:"getYieldSymbol",value:function(e){return this.symbolTable.getYield(e)}}]),t}(Compiler),InlineBlockCompiler=function(e){function t(e,n){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n),this.ops=new CompileIntoList(n,e.symbolTable)}return _inherits(t,e),_createClass(t,[{key:"compile",value:function(){var e=this.block,t=this.ops,n=e.program;e.hasPositionalParameters()&&t.append(new BindPositionalArgsOpcode({block:e}));for(var i=n.head();i;){var r=n.nextNode(i);this.compileStatement(i,t),i=r}return t}}]),t}(Compiler),ComponentLayoutBuilder=function(){function e(t){_classCallCheck(this,e),this.env=t}return _createClass(e,[{key:"empty",value:function(){this.inner=new EmptyBuilder(this.env)}},{key:"wrapLayout",value:function(e){this.inner=new WrappedBuilder(this.env,e)}},{key:"fromLayout",value:function(e){this.inner=new UnwrappedBuilder(this.env,e)}},{key:"compile",value:function(){return this.inner.compile()}},{key:"tag",get:function(){return this.inner.tag}},{key:"attrs",get:function(){return this.inner.attrs}}]),e}(),EmptyBuilder=function(){function e(t){_classCallCheck(this,e),this.env=t}return _createClass(e,[{key:"compile",value:function(){var e=this.env,t=new CompileIntoList(e,null);return new CompiledBlock(t,0)}},{key:"tag",get:function(){throw new Error("Nope")}},{key:"attrs",get:function(){throw new Error("Nope")}}]),e}(),WrappedBuilder=function(){function e(t,n){_classCallCheck(this,e),this.tag=new ComponentTagBuilder,this.attrs=new ComponentAttrsBuilder,this.env=t,this.layout=n}return _createClass(e,[{key:"compile",value:function(){var e=this.env,t=this.layout,n=t.symbolTable,i=new CompileIntoList(e,n),r=void 0;if(this.tag.isDynamic){var a=new LabelOpcode({label:"BODY"});r=this.tag.dynamicTagName.compile(i,e),i.append(new PutValueOpcode({expression:r})),i.append(new TestOpcode),i.append(new JumpUnlessOpcode({target:a})),i.append(new OpenDynamicPrimitiveElementOpcode),i.append(new DidCreateElementOpcode),this.attrs.buffer.forEach(function(t){return compileStatement(e,t,i,n)}),i.append(a)}else if(this.tag.isStatic){var s=this.tag.staticTagName;i.append(new OpenPrimitiveElementOpcode({tag:s})),i.append(new DidCreateElementOpcode),this.attrs.buffer.forEach(function(t){return compileStatement(e,t,i,n)})}if(t.hasNamedParameters()&&i.append(BindNamedArgsOpcode.create(t)),t.hasYields()&&i.append(BindBlocksOpcode.create(t)),t.program.forEachNode(function(n){return compileStatement(e,n,i,t.symbolTable)}),this.tag.isDynamic){var o=new LabelOpcode({label:"END"});i.append(new PutValueOpcode({expression:r})),i.append(new TestOpcode),i.append(new JumpUnlessOpcode({target:o})),i.append(new CloseElementOpcode),i.append(o)}else this.tag.isStatic&&i.append(new CloseElementOpcode);return new CompiledBlock(i,n.size)}}]),e}(),UnwrappedBuilder=function(){function e(t,n){_classCallCheck(this,e),this.attrs=new ComponentAttrsBuilder,this.env=t,this.layout=n}return _createClass(e,[{key:"compile",value:function(){var e=this.env,t=this.layout,n=new CompileIntoList(e,t.symbolTable);t.hasNamedParameters()&&n.append(BindNamedArgsOpcode.create(t)),t.hasYields()&&n.append(BindBlocksOpcode.create(t));var i=this.attrs.buffer,r=!1;return this.layout.program.forEachNode(function(a){compileStatement(e,a,n,t.symbolTable),!r&&isOpenElement$1(a)&&(n.append(new DidCreateElementOpcode),n.append(new ShadowAttributesOpcode),i.forEach(function(i){return compileStatement(e,i,n,t.symbolTable)}),r=!0)}),new CompiledBlock(n,t.symbolTable.size)}},{key:"tag",get:function(){throw new Error("BUG: Cannot call `tag` on an UnwrappedBuilder")}}]),e}(),ComponentTagBuilder=function(){function e(){_classCallCheck(this,e),this.isDynamic=null,this.isStatic=null,this.staticTagName=null,this.dynamicTagName=null}return _createClass(e,[{key:"static",value:function(e){this.isStatic=!0,this.staticTagName=e}},{key:"dynamic",value:function(e){this.isDynamic=!0,this.dynamicTagName=make(e)}}]),e}(),ComponentAttrsBuilder=function(){function e(){_classCallCheck(this,e),this.buffer=[]}return _createClass(e,[{key:"static",value:function(e,t){this.buffer.push(new StaticAttr({name:e,value:t}))}},{key:"dynamic",value:function(e,t){this.buffer.push(new DynamicAttr({name:e,value:make(t)}))}}]),e}(),ComponentBuilder=function(){function e(t,n){_classCallCheck(this,e),this.compiler=t,this.env=n}return _createClass(e,[{key:"static",value:function(e){var t=e.definition,n=e.args,i=e.shadow,r=e.templates,a=this.compiler,s=this.env,o=n.compile(a,s);a.append(new PutComponentDefinitionOpcode({args:o,definition:t})),a.append(new OpenComponentOpcode({shadow:i,templates:r})),a.append(new CloseComponentOpcode)}},{key:"dynamic",value:function(e){var t=e.definitionArgs,n=e.definition,i=e.args,r=e.shadow,a=e.templates,s=this.compiler,o=this.env,l=new LabelOpcode({label:"BEGIN"}),c=new LabelOpcode({label:"END"}),u=t.compile(s,o),h=make(n).compile(s,o),p=i.compile(s,o);s.append(new EnterOpcode({begin:l,end:c})),s.append(l),s.append(new PutArgsOpcode({args:u})),s.append(new PutValueOpcode({expression:h})),s.append(new TestOpcode),s.append(new JumpUnlessOpcode({target:c})),s.append(new PutDynamicComponentDefinitionOpcode({args:p})),s.append(new OpenComponentOpcode({shadow:r,templates:a})),s.append(new CloseComponentOpcode),s.append(c),s.append(new ExitOpcode)}}]),e}(),CompileIntoList=function(e){function t(e,n){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.env=e,this.symbolTable=n,this.component=new ComponentBuilder(this,e)}return _inherits(t,e),_createClass(t,[{key:"getLocalSymbol",value:function(e){return this.symbolTable.getLocal(e)}},{key:"hasLocalSymbol",value:function(e){return"number"==typeof this.symbolTable.getLocal(e)}},{key:"getNamedSymbol",value:function(e){return this.symbolTable.getNamed(e)}},{key:"hasNamedSymbol",value:function(e){return"number"==typeof this.symbolTable.getNamed(e)}},{key:"getBlockSymbol",value:function(e){return this.symbolTable.getYield(e)}},{key:"hasBlockSymbol",value:function(e){return"number"==typeof this.symbolTable.getYield(e)}},{key:"hasKeyword",value:function(e){return this.env.hasKeyword(e)}},{key:"toOpSeq",value:function(){return this}}]),t}(LinkedList),CompiledBlock=function e(t,n){_classCallCheck(this,e),this.ops=t,this.symbols=n},Block$1=function e(t){_classCallCheck(this,e),this.compiled=null,this.symbolTable=t.symbolTable||null,this.children=t.children,this.program=t.program},InlineBlock=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.locals=e.locals}return _inherits(t,e),_createClass(t,[{key:"hasPositionalParameters",value:function(){return!!this.locals.length}},{key:"compile",value:function(e){var t=this.compiled;if(t)return t;var n=new InlineBlockCompiler(this,e).compile();return this.compiled=new CompiledBlock(n,this.symbolTable.size)}}]),t}(Block$1),PartialBlock=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"initBlocks",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?this.children:arguments[0],n=arguments.length<=1||void 0===arguments[1]?this.symbolTable:arguments[1];return t.forEach(function(t){var i=SymbolTable.initForBlock({parent:n,block:t});e.initBlocks(t.children,i)}),this}}]),t}(InlineBlock),TopLevelTemplate=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"initBlocks",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?this.children:arguments[0],n=arguments.length<=1||void 0===arguments[1]?this.symbolTable:arguments[1];return t.forEach(function(t){var i=SymbolTable.initForBlock({parent:n,block:t});e.initBlocks(t.children,i)}),this}}]),t}(Block$1),EntryPoint=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"compile",value:function(e){var t=this.compiled;if(t)return t;var n=new EntryPointCompiler(this,e).compile();return this.compiled=new CompiledBlock(n,this.symbolTable.size)}}],[{key:"create",value:function(e){var n=new t(e);return SymbolTable.initForEntryPoint(n),n}}]),t}(TopLevelTemplate),Layout=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);var n=e.named,i=e.yields;this.named=n,this.yields=i}return _inherits(t,e),_createClass(t,[{key:"hasNamedParameters",value:function(){return!!this.named.length}},{key:"hasYields",value:function(){return!!this.yields.length}}],[{key:"create",value:function(e){var n=new t(e);return SymbolTable.initForLayout(n),n}}]),t}(TopLevelTemplate),Scanner=function(){function e(t,n){_classCallCheck(this,e),this.spec=t,this.env=n}return _createClass(e,[{key:"scanEntryPoint",value:function(){return this.scanTop(function(e){var t=e.program,n=e.children;return EntryPoint.create({children:n,program:t,symbolTable:null})})}},{key:"scanLayout",value:function(){var e=this;return this.scanTop(function(t){var n=t.program,i=t.children,r=e.spec,a=r.named,s=r.yields;return Layout.create({children:i,program:n,named:a,yields:s,symbolTable:null})})}},{key:"scanPartial",value:function(e){var t=this;return this.scanTop(function(n){var i=n.program,r=n.children,a=t.spec.locals;return new PartialBlock({children:r,program:i,locals:a,symbolTable:e})})}},{key:"scanTop",value:function(e){for(var t=this.spec,n=t.blocks,i=[],r=0,a=void 0;a=n[r];r++)i.push(this.buildBlock(a,i));return e(this.buildStatements(t,i)).initBlocks()}},{key:"buildBlock",value:function(e,t){var n=this.buildStatements(e,t),i=n.program,r=n.children;return new InlineBlock({children:r,locals:e.locals,program:i,symbolTable:null})}},{key:"buildStatements",value:function(e,t){var n=e.statements;return 0===n.length?EMPTY_PROGRAM:new BlockScanner(n,t,this.env).scan()}}]),e}(),EMPTY_PROGRAM={program:EMPTY_SLICE,children:[]},BlockScanner=function(){function e(t,n,i){_classCallCheck(this,e),this.stack=new Stack,this.stack.push(new ChildBlockScanner),this.reader=new SyntaxReader(t,n),this.env=i}return _createClass(e,[{key:"scan",value:function(){for(var e=void 0;e=this.reader.next();)this.addStatement(e);return{program:this.stack.current.program,children:this.stack.current.children}}},{key:"startBlock",value:function(){this.stack.push(new ChildBlockScanner)}},{key:"endBlock",value:function(){var e=this.stack.pop(),t=e.children,n=e.program,i=new InlineBlock({children:t,program:n,symbolTable:null,locals:[]});return this.addChild(i),i}},{key:"addChild",value:function(e){this.stack.current.addChild(e)}},{key:"addStatement",value:function(e){this.stack.current.addStatement(e.scan(this))}},{key:"next",value:function(){return this.reader.next()}},{key:"unput",value:function(e){this.reader.unput(e)}}]),e}(),ChildBlockScanner=function(){function e(){_classCallCheck(this,e),this.children=[],this.program=new LinkedList}return _createClass(e,[{key:"addChild",value:function(e){this.children.push(e)}},{key:"addStatement",value:function(e){this.program.append(e)}}]),e}(),SyntaxReader=function(){function e(t,n){_classCallCheck(this,e),this.current=0,this.last=null,this.statements=t,this.blocks=n}return _createClass(e,[{key:"unput",value:function(e){this.last=e}},{key:"next",value:function(){var e=this.last;if(e)return this.last=null,e;if(this.current===this.statements.length)return null;var t=this.statements[this.current++];return buildStatement(t,this.blocks)}}]),e}(),PushChildScopeOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="push-child-scope"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.pushChildScope()}}]),t}(Opcode),PopScopeOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="pop-scope"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.popScope()}}]),t}(Opcode),PutValueOpcode=function(e){function t(e){var n=e.expression;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="put-value",this.expression=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.evaluateOperand(this.expression)}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:[this.expression.toJSON()]}}}]),t}(Opcode),PutArgsOpcode=function(e){function t(e){var n=e.args;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="put-args",this.args=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.evaluateArgs(this.args)}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,details:{positional:this.args.positional.toJSON(),named:this.args.named.toJSON()}}}}]),t}(Opcode),BindPositionalArgsOpcode=function(e){function t(e){var n=e.block;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="bind-positional-args",this.names=n.locals;var i=this.positional=[];n.locals.forEach(function(e){i.push(n.symbolTable.getLocal(e))})}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.bindPositionalArgs(this.positional)}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:["["+this.names.map(function(e){return JSON.stringify(e)}).join(", ")+"]"]}}}]),t}(Opcode),BindNamedArgsOpcode=function(e){function t(e){var n=e.named;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="bind-named-args",this.named=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.bindNamedArgs(this.named)}},{key:"toJSON",value:function(){var e=this,t=Object.keys(this.named).map(function(t){return"$"+e.named[t]+": $ARGS["+t+"]"});return{guid:this._guid,type:this.type,args:t}}}],[{key:"create",value:function(e){var n=e.named.reduce(function(t,n){return assign(t,_defineProperty({},n,e.symbolTable.getNamed(n)))},dict());return turbocharge(n),new t({named:n})}}]),t}(Opcode),BindBlocksOpcode=function(e){function t(e){var n=e.blocks;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="bind-blocks",this.blocks=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.bindBlocks(this.blocks)}}],[{key:"create",value:function(e){var n=dict();return e.yields.forEach(function(t){n[t]=e.symbolTable.getYield(t)}),new t({blocks:n})}}]),t}(Opcode),EnterOpcode=function(e){function t(e){var n=e.begin,i=e.end;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="enter",this.slice=new ListSlice(n,i)}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.enter(this.slice)}},{key:"toJSON",value:function(){var e=this.slice,t=this.type,n=this._guid,i=e.head(),r=e.tail();return{guid:n,type:t,args:[JSON.stringify(i.inspect()),JSON.stringify(r.inspect())]}}}]),t}(Opcode),ExitOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="exit"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.exit()}}]),t}(Opcode),LabelOpcode=function(e){function t(e){var n=e.label;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.tag=CONSTANT_TAG,this.type="label",this.label=null,this.prev=null,this.next=null,n&&(this.label=n)}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(){}},{key:"inspect",value:function(){return this.label+" ["+this._guid+"]"}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:[JSON.stringify(this.inspect())]}}}]),t}(AbstractOpcode),EvaluateOpcode=function(e){function t(e){var n=e.debug,i=e.block;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="evaluate",this.debug=n,this.block=i}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.invokeBlock(this.block,e.frame.getArgs())}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:[this.debug]}}}]),t}(Opcode),EvaluatePartialOpcode=function(e){function t(e){var n=e.name,i=e.symbolTable;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="evaluate-partial",this.cache=dict(),this.name=n,this.symbolTable=i}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.name.evaluate(e),n=new ReferenceCache(t),i=n.revalidate(),r=this.cache[i];if(!r){var a=e.env.lookupPartial([i]),s=a.template,o=new Scanner(s,e.env);r=o.scanPartial(this.symbolTable)}e.invokeBlock(r,EvaluatedArgs.empty()),isConst(t)||e.updateWith(new Assert(n))}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:[this.name.toJSON()]}}}]),t}(Opcode),NameToPartialOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="name-to-partial"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=e.frame.getOperand(),n=new ReferenceCache(t),i=n.revalidate(),r=!(!i||!e.env.hasPartial([i]))&&e.env.lookupPartial([i]);e.frame.setOperand(new ValueReference(r)),isConst(t)||e.updateWith(new Assert(n))}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:["$OPERAND"]}}}]),t}(Opcode),TestOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="test"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.frame.setCondition(e.env.toConditionalReference(e.frame.getOperand()))}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:["$OPERAND"]}}}]),t}(Opcode),JumpOpcode=function(e){function t(e){var n=e.target;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="jump",this.target=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.goto(this.target)}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:[JSON.stringify(this.target.inspect())]}}}]),t}(Opcode),JumpIfOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="jump-if"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var n=e.frame.getCondition();if(isConst(n))n.value()&&_get(Object.getPrototypeOf(t.prototype),"evaluate",this).call(this,e);else{var i=new ReferenceCache(n);i.peek()&&_get(Object.getPrototypeOf(t.prototype),"evaluate",this).call(this,e),e.updateWith(new Assert(i))}}}]),t}(JumpOpcode),JumpUnlessOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="jump-unless"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var n=e.frame.getCondition();if(isConst(n))n.value()||_get(Object.getPrototypeOf(t.prototype),"evaluate",this).call(this,e);else{var i=new ReferenceCache(n);i.peek()||_get(Object.getPrototypeOf(t.prototype),"evaluate",this).call(this,e),e.updateWith(new Assert(i))}}}]),t}(JumpOpcode),Assert=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="assert",this.tag=e.tag,this.cache=e}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.cache;isModified(t.revalidate())&&e.throw()}},{key:"toJSON",value:function(){var e=this.type,t=this._guid,n=this.cache,i=void 0;try{i=JSON.stringify(n.peek())}catch(e){i=String(n.peek())}return{guid:t,type:e,args:[],details:{expected:i}}}}]),t}(UpdatingOpcode),JumpIfNotModifiedOpcode=function(e){function t(e){var n=e.tag,i=e.target;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="jump-if-not-modified",this.tag=n,this.target=i,this.lastRevision=n.value()}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.tag,n=this.target,i=this.lastRevision;t.validate(i)&&e.goto(n)}},{key:"didModify",value:function(){this.lastRevision=this.tag.value()}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:[JSON.stringify(this.target.inspect())]}}}]),t}(UpdatingOpcode),DidModifyOpcode=function(e){function t(e){var n=e.target;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="did-modify",this.tag=CONSTANT_TAG,this.target=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(){this.target.didModify()}}]),t}(UpdatingOpcode),_SerializedExpressions=SerializedExpressions,isAttr=_SerializedExpressions.isAttr,isConcat=_SerializedExpressions.isConcat,isGet=_SerializedExpressions.isGet,isHasBlock=_SerializedExpressions.isHasBlock,isHasBlockParams=_SerializedExpressions.isHasBlockParams,isHelper=_SerializedExpressions.isHelper,isUnknown=_SerializedExpressions.isUnknown,isValue=_SerializedExpressions.isValue,CompiledSymbolRef=function(e){function t(e){var n=e.debug,i=e.symbol,r=e.path;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.debug=n,this.symbol=i,this.path=r}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.referenceForSymbol(e);return referenceFromParts(t,this.path)}},{key:"toJSON",value:function(){var e=this.debug,t=this.symbol,n=this.path;return n.length?"$"+t+"("+e+")."+n.join("."):"$"+t+"("+e+")"}}]),t}(CompiledExpression),CompiledKeywordRef=function(){function e(t){var n=t.name,i=t.path;_classCallCheck(this,e),this.type="keyword-ref",this.name=n,this.path=i}return _createClass(e,[{key:"evaluate",value:function(e){var t=e.dynamicScope()[this.name];return referenceFromParts(t,this.path)}},{key:"toJSON",value:function(){var e=this.name,t=this.path;return t.length?"$KEYWORDS["+e+"]."+t.join("."):"$KEYWORDS["+e+"]"}}]),e}(),CompiledLocalRef=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="local-ref"}return _inherits(t,e),_createClass(t,[{key:"referenceForSymbol",value:function(e){return e.referenceForSymbol(this.symbol)}}]),t}(CompiledSymbolRef),CompiledSelfRef=function(e){function t(e){var n=e.parts;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="self-ref",this.parts=n}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){return referenceFromParts(e.getSelf(),this.parts)}},{key:"toJSON",value:function(){var e=["self"];return e.push.apply(e,_toConsumableArray(this.parts)),e.join(".")}}]),t}(CompiledExpression),CompiledHasBlock=function(e){function t(e){var n=e.blockName,i=e.blockSymbol;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="has-block",this.blockName=n,this.blockSymbol=i}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=e.scope().getBlock(this.blockSymbol);return new ValueReference(!!t)}},{key:"toJSON",value:function(){return"has-block("+this.blockName+")"}}]),t}(CompiledExpression),CompiledHasBlockParams=function(e){function t(e){var n=e.blockName,i=e.blockSymbol;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="has-block-params",this.blockName=n,this.blockSymbol=i}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=e.scope().getBlock(this.blockSymbol);return new ValueReference(!!(t&&t.locals.length>0))}},{key:"toJSON",value:function(){return"has-block-params("+this.blockName+")"}}]),t}(CompiledExpression),CompiledHelper=function(e){function t(e){var n=e.name,i=e.helper,r=e.args;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="helper",this.name=n,this.helper=i,this.args=r}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.helper;return t(this.args.evaluate(e))}},{key:"toJSON",value:function(){return"`"+this.name.join(".")+"($ARGS)`"}}]),t}(CompiledExpression),Upsert=function e(t){_classCallCheck(this,e),this.bounds=t},TextUpsert=function(e){function t(e,n){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.textNode=n}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e,t){if(isString(t)){var n=this.textNode;return n.nodeValue=t,!0}return!1}}],[{key:"insert",value:function(e,n,i){var r=e.insertTextBefore(n.element,n.nextSibling,i),a=new SingleNodeBounds(n.element,r);return new t(a,r)}}]),t}(Upsert),HTMLUpsert=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e,t){if(isString(t)){var n=this.bounds,i=n.parentElement(),r=clear(n);return this.bounds=e.insertHTMLBefore(i,r,t),!0}return!1}}],[{key:"insert",value:function(e,n,i){var r=e.insertHTMLBefore(n.element,n.nextSibling,i);return new t(r)}}]),t}(Upsert),SafeStringUpsert=function(e){function t(e,n){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.lastStringValue=n}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e,t){if(isSafeString(t)){var n=t.toHTML();if(n!==this.lastStringValue){var i=this.bounds,r=i.parentElement(),a=clear(i);this.bounds=e.insertHTMLBefore(r,a,n),this.lastStringValue=n}return!0}return!1}}],[{key:"insert",value:function(e,n,i){var r=i.toHTML(),a=e.insertHTMLBefore(n.element,n.nextSibling,r);return new t(a,r)}}]),t}(Upsert),NodeUpsert=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"update",value:function(e,t){if(isNode(t)){var n=this.bounds,i=n.parentElement(),r=clear(n);return this.bounds=e.insertNodeBefore(i,t,r),!0}return!1}}],[{key:"insert",value:function(e,n,i){var r=e.insertNodeBefore(n.element,i,n.nextSibling);return new t(r)}}]),t}(Upsert),AppendOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.normalize(e.frame.getOperand()),n=new ReferenceCache(t),i=n.peek(),r=e.stack(),a=this.insert(r.dom,r,i),s=new Fragment(a.bounds);e.stack().newBounds(s),isConst(t)||e.updateWith(this.updateWith(n,s,a))}},{key:"toJSON",value:function(){return{guid:this._guid,type:this.type,args:["$OPERAND"]}}}]),t}(Opcode),UpdateOpcode=function(e){function t(e,n,i){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.cache=e,this.bounds=n,this.upsert=i,this.tag=e.tag}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=this.cache.revalidate();if(isModified(t)){var n=this.bounds,i=this.upsert,r=e.dom;if(!this.upsert.update(r,t)){var a=new Cursor(n.parentElement(),clear(n));i=this.upsert=this.insert(r,a,t)}n.update(i.bounds)}}},{key:"toJSON",value:function(){var e=this._guid,t=this.type,n=dict();return n.lastValue=JSON.stringify(this.cache.peek()),{guid:e,type:t,details:n}}}]),t}(UpdatingOpcode),CautiousAppendOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="cautious-append"}return _inherits(t,e),_createClass(t,[{key:"normalize",value:function(e){return map$1(e,normalizeValue)}},{key:"insert",value:function(e,t,n){return cautiousInsert(e,t,n)}},{key:"updateWith",value:function(e,t,n){return new CautiousUpdateOpcode(e,t,n)}}]),t}(AppendOpcode),CautiousUpdateOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="cautious-update"}return _inherits(t,e),_createClass(t,[{key:"insert",value:function(e,t,n){return cautiousInsert(e,t,n)}}]),t}(UpdateOpcode),TrustingAppendOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="trusting-append"}return _inherits(t,e),_createClass(t,[{key:"normalize",value:function(e){return map$1(e,normalizeTrustedValue)}},{key:"insert",value:function(e,t,n){return trustingInsert(e,t,n)}},{key:"updateWith",value:function(e,t,n){return new TrustingUpdateOpcode(e,t,n)}}]),t}(AppendOpcode),TrustingUpdateOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="trusting-update"}return _inherits(t,e),_createClass(t,[{key:"insert",value:function(e,t,n){return trustingInsert(e,t,n)}}]),t}(UpdateOpcode),CompiledConcat=function(){function e(t){var n=t.parts;_classCallCheck(this,e),this.type="concat",this.parts=n}return _createClass(e,[{key:"evaluate",value:function(e){for(var t=new Array(this.parts.length),n=0;n<this.parts.length;n++)t[n]=this.parts[n].evaluate(e);return new ConcatReference(t)}},{key:"toJSON",value:function(){return"concat("+this.parts.map(function(e){return e.toJSON()}).join(", ")+")"}}]),e}(),ConcatReference=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.tag=combineTagged(e),this.parts=e}return _inherits(t,e),_createClass(t,[{key:"compute",value:function(){for(var e=new Array(this.parts.length),t=0;t<this.parts.length;t++)e[t]=normalizeTextValue(this.parts[t].value());return e.join("")}}]),t}(CachedReference),Block=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="block",this.path=e.path,this.args=e.args,this.templates=e.templates}return _inherits(t,e),_createClass(t,[{key:"scan",value:function(e){var t=this.templates,n=t.default,i=t.inverse;return n&&e.addChild(n),i&&e.addChild(i),this}},{key:"compile",value:function(e){throw new Error("SyntaxError")}},{key:"prettyPrint",value:function(){return null}}],[{key:"fromSpec",value:function(e,n){var i=_slicedToArray(e,6),r=i[1],a=i[2],s=i[3],o=i[4],l=i[5];return new t({path:r,args:Args.fromSpec(a,s),templates:Templates.fromSpec([o,l],n)})}},{key:"build",value:function(e){return new this(e)}}]),t}(StatementSyntax),UnknownSyntax=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="unknown",this.ref=e.ref,this.trustingMorph=!!e.unsafe}return _inherits(t,e),_createClass(t,[{
key:"compile",value:function(e,t){var n=this.ref;return t.hasHelper(n.parts)?new CompiledHelper({name:n.parts,helper:t.lookupHelper(n.parts),args:CompiledArgs.empty()}):this.ref.compile(e)}},{key:"simplePath",value:function(){return this.ref.simplePath()}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,2),i=n[1];return new t({ref:new Ref({parts:i})})}},{key:"build",value:function(e,t){return new this({ref:Ref.build(e),unsafe:t})}}]),t}(ExpressionSyntax),Append=function(e){function t(e){var n=e.value,i=e.trustingMorph;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="append",this.value=n,this.trustingMorph=i}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){var e=this.trustingMorph?"html":"text";return new PrettyPrint("append",e,[this.value.prettyPrint()])}},{key:"compile",value:function(e,t){e.append(new PutValueOpcode({expression:this.value.compile(e,t)})),this.trustingMorph?e.append(new TrustingAppendOpcode):e.append(new CautiousAppendOpcode)}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,3),i=n[1],r=n[2];return new t({value:buildExpression(i),trustingMorph:r})}},{key:"build",value:function(e,t){return new this({value:e,trustingMorph:t})}}]),t}(StatementSyntax),MODIFIER_SYNTAX="c0420397-8ff1-4241-882b-4b7a107c9632",Modifier=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this["c0420397-8ff1-4241-882b-4b7a107c9632"]=!0,this.type="modifier",this.path=e.path,this.args=e.args}return _inherits(t,e),_createClass(t,[{key:"compile",value:function(e,t){var n=this.args.compile(e,t);if(!t.hasModifier(this.path))throw new Error("Compile Error: "+this.path.join(".")+" is not a modifier");e.append(new ModifierOpcode({name:this.path[0],manager:t.lookupModifier(this.path),args:n}))}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,4),i=n[1],r=n[2],a=n[3];return new t({path:i,args:Args.fromSpec(r,a)})}},{key:"build",value:function(e,n){return new t({path:e,params:n.params,hash:n.hash})}}]),t}(StatementSyntax),DynamicProp=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this["e1185d30-7cac-4b12-b26a-35327d905d92"]=!0,this.type="dynamic-prop",this.name=e.name,this.value=e.value}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){var e=this.name,t=this.value;return new PrettyPrint("attr","prop",[e,t.prettyPrint()])}},{key:"compile",value:function(e,t){e.append(new PutValueOpcode({expression:this.value.compile(e,t)})),e.append(new DynamicPropOpcode(this))}},{key:"valueSyntax",value:function(){return this.value}},{key:"isAttribute",value:function(){return!1}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,3),i=n[1],r=n[2];return new t({name:i,value:buildExpression(r)})}},{key:"build",value:function(e,t){return new this({name:intern(e),value:t})}}]),t}(AttributeSyntax),StaticAttr=function(e){function t(e){var n=e.name,i=e.value,r=e.namespace,a=void 0===r?null:r;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this["e1185d30-7cac-4b12-b26a-35327d905d92"]=!0,this.type="static-attr",this.name=n,this.value=i,this.namespace=a}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){var e=this.name,t=this.value,n=this.namespace;return n?new PrettyPrint("attr","attr",[e,t],{namespace:n}):new PrettyPrint("attr","attr",[e,t])}},{key:"compile",value:function(e){e.append(new StaticAttrOpcode(this))}},{key:"valueSyntax",value:function(){return ValueSyntax.build(this.value)}},{key:"isAttribute",value:function(){return!0}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,4),i=n[1],r=n[2],a=n[3];return new t({name:i,value:r,namespace:a})}},{key:"build",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];return new this({name:intern(e),value:intern(t),namespace:n&&intern(n)})}}]),t}(AttributeSyntax),DynamicAttr=function(e){function t(e){var n=e.name,i=e.value,r=e.namespace,a=void 0===r?null:r;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this["e1185d30-7cac-4b12-b26a-35327d905d92"]=!0,this.type="dynamic-attr",this.name=n,this.value=i,this.namespace=a}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){var e=this.name,t=this.value,n=this.namespace;return n?new PrettyPrint("attr","attr",[e,t.prettyPrint()],{namespace:n}):new PrettyPrint("attr","attr",[e,t.prettyPrint()])}},{key:"compile",value:function(e,t){var n=this.namespace,i=this.value;e.append(new PutValueOpcode({expression:i.compile(e,t)})),n?e.append(new DynamicAttrNSOpcode(this)):e.append(new DynamicAttrOpcode(this))}},{key:"valueSyntax",value:function(){return this.value}},{key:"isAttribute",value:function(){return!0}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,4),i=n[1],r=n[2],a=n[3];return new t({name:i,namespace:a,value:buildExpression(r)})}},{key:"build",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?null:arguments[2],i=intern(e),r=n?intern(n):null;return new this({name:i,value:t,namespace:r})}}]),t}(AttributeSyntax),CloseElement=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="close-element"}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return new PrettyPrint("element","close-element")}},{key:"compile",value:function(e){e.append(new CloseElementOpcode)}}],[{key:"fromSpec",value:function(){return new t}},{key:"build",value:function(){return new this}}]),t}(StatementSyntax),Text$1=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="text",this.content=e.content}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return new PrettyPrint("append","text",[this.content])}},{key:"compile",value:function(e){e.append(new TextOpcode({text:this.content}))}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,2),i=n[1];return new t({content:i})}},{key:"build",value:function(e){return new this({content:e})}}]),t}(StatementSyntax),Comment=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="comment",this.comment=e.value}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return new PrettyPrint("append","append-comment",[this.comment])}},{key:"compile",value:function(e){e.append(new CommentOpcode(this))}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,2),i=n[1];return new t({value:i})}},{key:"build",value:function(e){return new this({value:intern(e)})}}]),t}(StatementSyntax),OpenElement=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="open-element",this.tag=e.tag,this.blockParams=e.blockParams}return _inherits(t,e),_createClass(t,[{key:"scan",value:function(e){var t=this.tag;if(e.env.hasComponentDefinition([t])){var n=this.attributes(e),i=n.args,r=n.attrs;e.startBlock(),this.tagContents(e);var a=e.endBlock();return new Component({tag:t,args:i,attrs:r,template:a})}return new OpenPrimitiveElement({tag:t})}},{key:"prettyPrint",value:function(){var e=new PrettyPrint("block-params","as",this.blockParams);return new PrettyPrint("element","open-element",[this.tag,e])}},{key:"compile",value:function(e,t){e.append(new OpenPrimitiveElementOpcode(this))}},{key:"toIdentity",value:function(){var e=this.tag;return new OpenPrimitiveElement({tag:e})}},{key:"attributes",value:function(e){for(var t=e.next(),n=dict(),i=[];t[ATTRIBUTE_SYNTAX]||t[MODIFIER_SYNTAX];){if(t[MODIFIER_SYNTAX])throw new Error("Compile Error: Element modifiers are not allowed in components");var r=t;n[r.name]=r.valueSyntax(),r.isAttribute()&&i.push(r.name),t=e.next()}return e.unput(t),{args:Args.fromNamedArgs(NamedArgs.build(n)),attrs:i}}},{key:"tagContents",value:function(e){for(var n=1;;){var i=e.next();if(i instanceof CloseElement&&0===--n)break;e.addStatement(i),(i instanceof t||i instanceof OpenPrimitiveElement)&&n++}}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,3),i=n[1],r=n[2];return new t({tag:i,blockParams:r})}},{key:"build",value:function(e,t){return new this({tag:intern(e),blockParams:t&&t.map(intern)})}}]),t}(StatementSyntax),Component=function(e){function t(e){var n=e.tag,i=e.args,r=e.attrs,a=e.template;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="component",this.tag=n,this.args=i,this.attrs=r,this.template=a}return _inherits(t,e),_createClass(t,[{key:"compile",value:function(e,t){var n=t.getComponentDefinition([this.tag]),i=this.args.compile(e,t),r=this.attrs,a=new Templates({template:this.template,inverse:null});e.append(new PutComponentDefinitionOpcode({args:i,definition:n})),e.append(new OpenComponentOpcode({shadow:r,templates:a})),e.append(new CloseComponentOpcode)}}]),t}(StatementSyntax),OpenPrimitiveElement=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="open-primitive-element",this.tag=e.tag}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return new PrettyPrint("element","open-element",[this.tag])}},{key:"compile",value:function(e){e.append(new OpenPrimitiveElementOpcode({tag:this.tag}))}}],[{key:"build",value:function(e){return new this({tag:intern(e)})}}]),t}(StatementSyntax),Yield=function(e){function t(e){var n=e.to,i=e.args;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="yield",this.to=n,this.args=i}return _inherits(t,e),_createClass(t,[{key:"compile",value:function(e,t){var n=e.getBlockSymbol(this.to),i=this.args.compile(e,t);e.append(new OpenBlockOpcode({to:n,label:this.to,args:i})),e.append(new CloseBlockOpcode)}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,3),i=n[1],r=n[2],a=Args.fromSpec(r,null);return new t({to:i,args:a})}},{key:"build",value:function(e,t){var n=Args.fromPositionalArgs(PositionalArgs.build(e));return new this({to:intern(t),args:n})}}]),t}(StatementSyntax),OpenBlockOpcode=function(e){function t(e){var n=e.to,i=e.label,r=e.args;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="open-block",this.to=n,this.label=i,this.args=r}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=e.scope().getBlock(this.to),n=void 0;t&&(n=this.args.evaluate(e)),e.pushCallerScope(),t&&e.invokeBlock(t,n)}}]),t}(Opcode),CloseBlockOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="close-block"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.popScope()}}]),t}(Opcode),ValueSyntax=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="value",this.value=e}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return String(this.value)}},{key:"inner",value:function(){return this.value}},{key:"compile",value:function(e){return new CompiledValue(this)}}],[{key:"fromSpec",value:function(e){return new t(e)}},{key:"build",value:function(e){return new this(e)}}]),t}(ExpressionSyntax),GetSyntax=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="get",this.ref=e.ref}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return new PrettyPrint("expr","get",[this.ref.prettyPrint()],null)}},{key:"compile",value:function(e){return this.ref.compile(e)}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,2),i=n[1];return new t({ref:new Ref({parts:i})})}},{key:"build",value:function(e){return new this({ref:Ref.build(e)})}}]),t}(ExpressionSyntax),AttrSyntax=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="get-named-parameter",this.parts=e.parts}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return new PrettyPrint("expr","get-named",[this.parts.join(".")],null)}},{key:"compile",value:function(e){var t=this.parts,n=t[0],i=e.getNamedSymbol(n),r=t.slice(1);return new CompiledLocalRef({debug:n,symbol:i,path:r})}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,2),i=n[1];return new t({parts:i})}},{key:"build",value:function(e){return new this({parts:e.split(".").map(intern)})}}]),t}(ExpressionSyntax),Ref=function(e){function t(e){var n=e.parts;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="ref",this.parts=n}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return this.parts.join(".")}},{key:"compile",value:function(e){var t=this.parts,n=t[0],i=t.slice(1);if(e.hasKeyword(n))return new CompiledKeywordRef({name:n,path:i});if(e.hasLocalSymbol(n)){var r=e.getLocalSymbol(n);return new CompiledLocalRef({debug:n,symbol:r,path:i})}return new CompiledSelfRef({parts:t})}},{key:"path",value:function(){return this.parts}},{key:"simplePath",value:function(){if(1===this.parts.length)return this.parts[0]}}],[{key:"build",value:function(e){return new this({parts:internPath(e)})}}]),t}(ExpressionSyntax),HelperSyntax=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="helper",this.isStatic=!1,this.ref=e.ref,this.args=e.args}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){var e=this.args.prettyPrint(),t=_slicedToArray(e,2),n=t[0],i=t[1];return new PrettyPrint("expr",this.ref.prettyPrint(),n,i)}},{key:"compile",value:function(e,t){if(t.hasHelper(this.ref.parts)){var n=this.args,i=this.ref;return new CompiledHelper({name:i.parts,helper:t.lookupHelper(i.parts),args:n.compile(e,t)})}throw new Error("Compile Error: "+this.ref.prettyPrint()+" is not a helper")}},{key:"simplePath",value:function(){return this.ref.simplePath()}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,4),i=n[1],r=n[2],a=n[3];return new t({ref:new Ref({parts:i}),args:Args.fromSpec(r,a)})}},{key:"build",value:function(e,t,n){return new this({ref:Ref.build(e),args:new Args({positional:t,named:n})})}}]),t}(ExpressionSyntax),HasBlockSyntax=function(e){function t(e){var n=e.blockName;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="has-block",this.blockName=n}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return new PrettyPrint("expr","has-block",[this.blockName])}},{key:"compile",value:function(e,t){return new CompiledHasBlock({blockName:this.blockName,blockSymbol:e.getBlockSymbol(this.blockName)})}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,2),i=n[1];return new t({blockName:i})}},{key:"build",value:function(e){return new this({blockName:e})}}]),t}(ExpressionSyntax),HasBlockParamsSyntax=function(e){function t(e){var n=e.blockName;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="has-block-params",this.blockName=n}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return new PrettyPrint("expr","has-block-params",[this.blockName])}},{key:"compile",value:function(e,t){return new CompiledHasBlockParams({blockName:this.blockName,blockSymbol:e.getBlockSymbol(this.blockName)})}}],[{key:"fromSpec",value:function(e){var n=_slicedToArray(e,2),i=n[1];return new t({blockName:i})}},{key:"build",value:function(e){return new this({blockName:e})}}]),t}(ExpressionSyntax),ConcatSyntax=function(){function e(t){var n=t.parts;_classCallCheck(this,e),this.type="concat",this.isStatic=!1,this.parts=n}return _createClass(e,[{key:"prettyPrint",value:function(){return new PrettyPrint("expr","concat",this.parts.map(function(e){return e.prettyPrint()}))}},{key:"compile",value:function(e,t){return new CompiledConcat({parts:this.parts.map(function(n){return n.compile(e,t)})})}}],[{key:"fromSpec",value:function(t){var n=_slicedToArray(t,2),i=n[1];return new e({parts:i.map(buildExpression)})}},{key:"build",value:function(e){return new this({parts:e})}}]),e}(),Args=function(){function e(t){_classCallCheck(this,e),this.type="args",this.isStatic=!1,this.positional=t.positional,this.named=t.named}return _createClass(e,[{key:"prettyPrint",value:function(){return null}},{key:"compile",value:function(e,t){var n=this.positional,i=this.named;return CompiledArgs.create({positional:n.compile(e,t),named:i.compile(e,t)})}}],[{key:"fromSpec",value:function(t,n){return new e({positional:PositionalArgs.fromSpec(t),named:NamedArgs.fromSpec(n)})}},{key:"empty",value:function(){return this._empty=this._empty||new e({positional:PositionalArgs.empty(),named:NamedArgs.empty()})}},{key:"fromPositionalArgs",value:function(t){return new e({positional:t,named:NamedArgs.empty()})}},{key:"fromNamedArgs",value:function(t){return new e({positional:PositionalArgs.empty(),named:t})}},{key:"build",value:function(e,t){return new this({positional:e,named:t})}}]),e}(),PositionalArgs=function(){function e(t){_classCallCheck(this,e),this.type="positional",this.isStatic=!1,this.values=t,this.length=t.length}return _createClass(e,[{key:"slice",value:function(t,n){return e.build(this.values.slice(t,n))}},{key:"at",value:function(e){return this.values[e]}},{key:"compile",value:function(e,t){return CompiledPositionalArgs.create({values:this.values.map(function(n){return n.compile(e,t)})})}}],[{key:"fromSpec",value:function(t){return t&&0!==t.length?new e(t.map(buildExpression)):e.empty()}},{key:"build",value:function(e){return new this(e)}},{key:"empty",value:function(){return this._empty=this._empty||new e([])}}]),e}(),NamedArgs=function(){function e(t){var n=t.map;_classCallCheck(this,e),this.type="named",this.isStatic=!1,this.map=n}return _createClass(e,[{key:"prettyPrint",value:function(){return JSON.stringify(this.map)}},{key:"add",value:function(e,t){this.map[e]=t}},{key:"at",value:function(e){return this.map[e]}},{key:"has",value:function(e){return!!this.map[e]}},{key:"compile",value:function(e,t){var n=this.map,i=dict();return Object.keys(n).forEach(function(r){i[r]=n[r].compile(e,t)}),CompiledNamedArgs.create({map:i})}}],[{key:"fromSpec",value:function(t){if(null===t||void 0===t)return e.empty();var n=[],i=[],r=dict();return Object.keys(t).forEach(function(e){n.push(e);var a=r[e]=buildExpression(t[e]);i.push(a)}),new this({map:r})}},{key:"build",value:function(t){var n=[],i=[];return Object.keys(t).forEach(function(e){var r=t[e];n.push(e),i.push(r)}),new e({map:t})}},{key:"empty",value:function(){return this._empty=this._empty||new e({map:dict()})}}]),e}(),Templates=function(){function e(t){_classCallCheck(this,e),this.type="templates",this.default=t.template,this.inverse=t.inverse}return _createClass(e,null,[{key:"fromSpec",value:function(t,n){var i=_slicedToArray(t,2),r=i[0],a=i[1];return new e({template:null===r?null:n[r],inverse:null===a?null:n[a]})}},{key:"empty",value:function(){return new e({template:null,inverse:null})}},{key:"build",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return new this({template:e,inverse:t})}}]),e}(),IfSyntax=function(e){function t(e){var n=e.args,i=e.templates;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="if-statement",this.isStatic=!1,this.args=n,this.templates=i}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return"#if "+this.args.prettyPrint()}},{key:"compile",value:function(e,t){var n=new LabelOpcode({label:"BEGIN"}),i=new LabelOpcode({label:"ELSE"}),r=new LabelOpcode({label:"END"});e.append(new EnterOpcode({begin:n,end:r})),e.append(n),e.append(new PutArgsOpcode({args:this.args.compile(e,t)})),e.append(new TestOpcode),this.templates.inverse?(e.append(new JumpUnlessOpcode({target:i})),e.append(new EvaluateOpcode({debug:"default",block:this.templates.default})),e.append(new JumpOpcode({target:r})),e.append(i),e.append(new EvaluateOpcode({debug:"inverse",block:this.templates.inverse}))):(e.append(new JumpUnlessOpcode({target:r})),e.append(new EvaluateOpcode({debug:"default",block:this.templates.default}))),e.append(r),e.append(new ExitOpcode)}}]),t}(StatementSyntax),UnlessSyntax=function(e){function t(e){var n=e.args,i=e.templates;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="unless-statement",this.isStatic=!1,this.args=n,this.templates=i}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return"#unless "+this.args.prettyPrint()}},{key:"compile",value:function(e,t){var n=new LabelOpcode({label:"BEGIN"}),i=new LabelOpcode({label:"ELSE"}),r=new LabelOpcode({label:"END"});e.append(new EnterOpcode({begin:n,end:r})),e.append(n),e.append(new PutArgsOpcode({args:this.args.compile(e,t)})),e.append(new TestOpcode),this.templates.inverse?(e.append(new JumpIfOpcode({target:i})),e.append(new EvaluateOpcode({debug:"default",block:this.templates.default})),e.append(new JumpOpcode({target:r})),e.append(i),e.append(new EvaluateOpcode({debug:"inverse",block:this.templates.inverse}))):(e.append(new JumpIfOpcode({target:r})),e.append(new EvaluateOpcode({debug:"default",block:this.templates.default}))),e.append(r),e.append(new ExitOpcode)}}]),t}(StatementSyntax),WithSyntax=function(e){function t(e){var n=e.args,i=e.templates;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="with-statement",this.isStatic=!1,this.args=n,this.templates=i}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return"#with "+this.args.prettyPrint()}},{key:"compile",value:function(e,t){var n=new LabelOpcode({label:"BEGIN"}),i=new LabelOpcode({label:"ELSE"}),r=new LabelOpcode({label:"END"});e.append(new EnterOpcode({begin:n,end:r})),e.append(n),e.append(new PutArgsOpcode({args:this.args.compile(e,t)})),e.append(new TestOpcode),this.templates.inverse?e.append(new JumpUnlessOpcode({target:i})):e.append(new JumpUnlessOpcode({target:r})),e.append(new EvaluateOpcode({debug:"default",block:this.templates.default})),e.append(new JumpOpcode({target:r})),this.templates.inverse&&(e.append(i),e.append(new EvaluateOpcode({debug:"inverse",block:this.templates.inverse}))),e.append(r),e.append(new ExitOpcode)}}]),t}(StatementSyntax),IterablePresenceReference=function(){function e(t){_classCallCheck(this,e),this.tag=VOLATILE_TAG,this.artifacts=t}return _createClass(e,[{key:"value",value:function(){return!this.artifacts.isEmpty()}}]),e}(),PutIteratorOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="put-iterator"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=e.frame.getOperand(),n=e.frame.getArgs(),i=e.env.iterableFor(t,n),r=new ReferenceIterator(i);e.frame.setIterator(r),e.frame.setCondition(new IterablePresenceReference(r.artifacts))}}]),t}(Opcode),EnterListOpcode=function(e){function t(e,n){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="enter-list",this.slice=new ListSlice(e,n)}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.enterList(this.slice)}},{key:"toJSON",value:function(){var e=this.slice,t=this.type,n=this._guid,i=e.head(),r=e.tail();return{guid:n,type:t,args:[JSON.stringify(i.inspect()),JSON.stringify(r.inspect())]}}}]),t}(Opcode),ExitListOpcode=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.type="exit-list"}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.exitList()}}]),t}(Opcode),EnterWithKeyOpcode=function(e){function t(e,n){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="enter-with-key",this.slice=new ListSlice(e,n)}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){e.enterWithKey(e.frame.getKey(),this.slice)}},{key:"toJSON",value:function(){var e=this.slice,t=this._guid,n=this.type,i=e.head(),r=e.tail();return{guid:t,type:n,args:[JSON.stringify(i.inspect()),JSON.stringify(r.inspect())]}}}]),t}(Opcode),TRUE_REF=new ConstReference(!0),FALSE_REF=new ConstReference(!1),NextIterOpcode=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="next-iter",this.end=e}return _inherits(t,e),_createClass(t,[{key:"evaluate",value:function(e){var t=e.frame.getIterator().next();t?(e.frame.setCondition(TRUE_REF),e.frame.setKey(t.key),e.frame.setOperand(t.value),e.frame.setArgs(EvaluatedArgs.positional([t.value,t.memo]))):(e.frame.setCondition(FALSE_REF),e.goto(this.end))}}]),t}(Opcode),EachSyntax=function(e){function t(e){var n=e.args,i=e.templates;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="each-statement",this.isStatic=!1,this.args=n,this.templates=i}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return"#each "+this.args.prettyPrint()}},{key:"compile",value:function(e,t){var n=new LabelOpcode({label:"BEGIN"}),i=new LabelOpcode({label:"ITER"}),r=new LabelOpcode({label:"BEGIN2"}),a=new LabelOpcode({label:"END2"}),s=new LabelOpcode({label:"BREAK"}),o=new LabelOpcode({label:"ELSE"}),l=new LabelOpcode({label:"END"});e.append(new EnterOpcode({begin:n,end:l})),e.append(n),e.append(new PutArgsOpcode({args:this.args.compile(e,t)})),e.append(new PutIteratorOpcode),this.templates.inverse?e.append(new JumpUnlessOpcode({target:o})):e.append(new JumpUnlessOpcode({target:l})),e.append(new EnterListOpcode(r,a)),e.append(i),e.append(new NextIterOpcode(s)),e.append(new EnterWithKeyOpcode(r,a)),e.append(r),e.append(new PushChildScopeOpcode),e.append(new EvaluateOpcode({debug:"default",block:this.templates.default})),e.append(new PopScopeOpcode),e.append(a),e.append(new ExitOpcode),e.append(new JumpOpcode({target:i})),e.append(s),e.append(new ExitListOpcode),e.append(new JumpOpcode({target:l})),this.templates.inverse&&(e.append(o),e.append(new EvaluateOpcode({debug:"inverse",block:this.templates.inverse}))),e.append(l),e.append(new ExitOpcode)}}]),t}(StatementSyntax),PartialSyntax=function(e){function t(e){var n=e.args;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="partial-statement",this.isStatic=!1,this.args=n}return _inherits(t,e),_createClass(t,[{key:"prettyPrint",value:function(){return"partial "+this.args.prettyPrint()}},{key:"compile",value:function(e,t,n){debugAssert(this.args.positional.values.length>0,"Partial found with no arguments. You must specify a template."),debugAssert(this.args.positional.values.length<2,"Partial found with more than one argument. You can only specify a single template.");var i=this.args.positional.values[0].compile(e,t),r=new LabelOpcode({label:"BEGIN"}),a=new LabelOpcode({label:"END"});e.append(new EnterOpcode({begin:r,end:a})),e.append(r),e.append(new PutArgsOpcode({args:this.args.compile(e,t)})),e.append(new NameToPartialOpcode),e.append(new TestOpcode),e.append(new JumpUnlessOpcode({target:a})),e.append(new EvaluatePartialOpcode({name:i,symbolTable:n})),e.append(a),e.append(new ExitOpcode)}}]),t}(StatementSyntax),Scope=function(){function e(t){_classCallCheck(this,e),this.callerScope=null,this.slots=t}return _createClass(e,[{key:"init",value:function(e){var t=e.self;return this.slots[0]=t,this}},{key:"getSelf",value:function(){return this.slots[0]}},{key:"getSymbol",value:function(e){return this.slots[e]}},{key:"getBlock",value:function(e){return this.slots[e]}},{key:"bindSymbol",value:function(e,t){this.slots[e]=t}},{key:"bindBlock",value:function(e,t){this.slots[e]=t}},{key:"bindCallerScope",value:function(e){this.callerScope=e}},{key:"getCallerScope",value:function(){return this.callerScope}},{key:"child",value:function(){return new e(this.slots.slice())}}],[{key:"root",value:function(t){for(var n=arguments.length<=1||void 0===arguments[1]?0:arguments[1],i=new Array(n+1),r=0;r<=n;r++)i[r]=NULL_REFERENCE;return new e(i).init({self:t})}}]),e}(),Environment=function(){function e(t){_classCallCheck(this,e),this.createdComponents=null,this.createdManagers=null,this.updatedComponents=null,this.updatedManagers=null,this.destructors=null,this.dom=t}return _createClass(e,[{key:"toConditionalReference",value:function(e){return new ConditionalReference(e)}},{key:"getDOM",value:function(){return this.dom}},{key:"getIdentity",value:function(e){return intern(ensureGuid(e)+"")}},{key:"statement",value:function(e){return this.refineStatement(parseStatement(e))||e}},{key:"refineStatement",value:function(e){var t=e.isSimple,n=e.isBlock,i=e.isInline,r=e.key,a=e.args,s=e.templates;if(t&&i&&"partial"===r)return new PartialSyntax({args:a});if(t&&n)switch(r){case"each":return new EachSyntax({args:a,templates:s});case"if":return new IfSyntax({args:a,templates:s});case"with":return new WithSyntax({args:a,templates:s});case"unless":return new UnlessSyntax({args:a,templates:s})}}},{key:"begin",value:function(){this.createdComponents=[],this.createdManagers=[],this.updatedComponents=[],this.updatedManagers=[],this.destructors=[]}},{key:"didCreate",value:function(e,t){this.createdComponents.push(e),this.createdManagers.push(t)}},{key:"didUpdate",value:function(e,t){this.updatedComponents.push(e),this.updatedManagers.push(t)}},{key:"didDestroy",value:function(e){this.destructors.push(e)}},{key:"commit",value:function(){for(var e=0;e<this.createdComponents.length;e++){var t=this.createdComponents[e],n=this.createdManagers[e];n.didCreate(t)}for(var e=this.updatedComponents.length-1;e>=0;e--){var t=this.updatedComponents[e],n=this.updatedManagers[e];n.didUpdate(t)}for(var e=0;e<this.destructors.length;e++)this.destructors[e].destroy()}},{key:"hasKeyword",value:function(e){return!1}}]),e}(),UpdatingVM=function(){function e(t){_classCallCheck(this,e),this.frameStack=new Stack,this.env=t,this.dom=t.getDOM()}return _createClass(e,[{key:"execute",value:function(e,t){var n=this.frameStack;for(this.try(e,t);;){if(n.isEmpty())break;var i=this.frameStack.current.nextStatement();null!==i?(LOGGER.debug("[VM] OP "+i.type),LOGGER.trace(i),i.evaluate(this)):this.frameStack.pop()}}},{key:"goto",value:function(e){this.frameStack.current.goto(e)}},{key:"try",value:function(e,t){this.frameStack.push(new UpdatingVMFrame(this,e,t))}},{key:"throw",value:function(){this.frameStack.current.handleException(),this.frameStack.pop()}},{key:"evaluateOpcode",value:function(e){e.evaluate(this)}}]),e}(),BlockOpcode=function(e){function t(e){var n=e.ops,i=e.children,r=e.state;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="block",this.next=null,this.prev=null;var a=r.env,s=r.scope,o=r.dynamicScope,l=r.block;this.ops=n,this.children=i,this.env=a,this.scope=s,this.dynamicScope=o,this.bounds=l}return _inherits(t,e),_createClass(t,[{key:"parentElement",value:function(){return this.bounds.parentElement()}},{key:"firstNode",value:function(){return this.bounds.firstNode()}},{key:"lastNode",value:function(){return this.bounds.lastNode()}},{key:"evaluate",value:function(e){e.try(this.children,null)}},{key:"destroy",value:function(){this.bounds.destroy()}},{key:"didDestroy",value:function(){this.env.didDestroy(this.bounds)}},{key:"toJSON",value:function(){var e=this.ops.head(),t=this.ops.tail(),n=dict();return n.guid=""+this._guid,n.begin=e.inspect(),n.end=t.inspect(),{guid:this._guid,type:this.type,
details:n,children:this.children.toArray().map(function(e){return e.toJSON()})}}}]),t}(UpdatingOpcode),TryOpcode=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.type="try",this.tag=this._tag=new UpdatableTag(CONSTANT_TAG)}return _inherits(t,e),_createClass(t,[{key:"didInitializeChildren",value:function(){this._tag.update(combineSlice(this.children))}},{key:"evaluate",value:function(e){e.try(this.children,this)}},{key:"handleException",value:function(){var e=this.env,t=this.scope,n=this.dynamicScope,i=ElementStack.resume({dom:this.env.getDOM(),tracker:this.bounds,nextSibling:this.bounds.reset(e)}),r=new VM({env:e,scope:t,dynamicScope:n,elementStack:i}),a=r.execute(this.ops);this.children=a.opcodes(),this.didInitializeChildren()}},{key:"toJSON",value:function(){var e=_get(Object.getPrototypeOf(t.prototype),"toJSON",this).call(this),n=this.ops.head(),i=this.ops.tail();return e.details.begin=JSON.stringify(n.inspect()),e.details.end=JSON.stringify(i.inspect()),_get(Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}}]),t}(BlockOpcode),ListRevalidationDelegate=function(){function e(t,n){_classCallCheck(this,e),this.didInsert=!1,this.didDelete=!1,this.opcode=t,this.map=t.map,this.updating=t.children,this.marker=n}return _createClass(e,[{key:"insert",value:function(e,t,n,i){var r=this.map,a=this.opcode,s=this.updating,o=null,l=null;i?(l=r[i],o=l.bounds.firstNode()):o=this.marker;var c=a.vmForInsertion(o),u=void 0;c.execute(a.ops,function(i){i.frame.setArgs(EvaluatedArgs.positional([t,n])),i.frame.setOperand(t),i.frame.setCondition(new ConstReference(!0)),i.frame.setKey(e);var r=i.capture();u=new TryOpcode({state:r,ops:a.ops,children:i.updatingOpcodeStack.current})}),s.insertBefore(u,l),r[e]=u,this.didInsert=!0}},{key:"retain",value:function(e,t,n){}},{key:"move",value:function(e,t,n,i){var r=this.map,a=this.updating,s=r[e],o=r[i]||null;i?moveBounds(s,o.firstNode()):moveBounds(s,this.marker),a.remove(s),a.insertBefore(s,o)}},{key:"delete",value:function(e){var t=this.map,n=t[e];clear(n),n.didDestroy(),this.updating.remove(n),delete t[e],this.didDelete=!0}},{key:"done",value:function(){(this.didInsert||this.didDelete)&&this.opcode.didInitializeChildren()}}]),e}(),ListBlockOpcode=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.type="list-block",this.map=dict(),this.artifacts=e.artifacts,this.tag=this._tag=new UpdatableTag(CONSTANT_TAG)}return _inherits(t,e),_createClass(t,[{key:"didInitializeChildren",value:function(){this._tag.update(combineSlice(this.children))}},{key:"evaluate",value:function(e){var n=this.artifacts,i=this.bounds,r=e.dom,a=r.createComment("");r.insertAfter(i.parentElement(),a,i.lastNode());var s=new ListRevalidationDelegate(this,a),o=new IteratorSynchronizer({target:s,artifacts:n});o.sync(),this.parentElement().removeChild(a),_get(Object.getPrototypeOf(t.prototype),"evaluate",this).call(this,e)}},{key:"vmForInsertion",value:function(e){var t=this.env,n=this.scope,i=this.dynamicScope,r=ElementStack.forInitialRender({dom:this.env.getDOM(),parentNode:this.bounds.parentElement(),nextSibling:e});return new VM({env:t,scope:n,dynamicScope:i,elementStack:r})}},{key:"toJSON",value:function(){var e=_get(Object.getPrototypeOf(t.prototype),"toJSON",this).call(this),n=this.map,i=Object.keys(n).map(function(e){return JSON.stringify(e)+": "+n[e]._guid}).join(", ");return e.details.map="{"+i+"}",e}}]),t}(BlockOpcode),UpdatingVMFrame=function(){function e(t,n,i){_classCallCheck(this,e),this.vm=t,this.ops=n,this.current=n.head(),this.exceptionHandler=i}return _createClass(e,[{key:"goto",value:function(e){this.current=e}},{key:"nextStatement",value:function(){var e=this.current,t=this.ops;return e&&(this.current=t.nextNode(e)),e}},{key:"handleException",value:function(){this.exceptionHandler.handleException()}}]),e}(),RenderResult=function(){function e(t){var n=t.env,i=t.updating,r=t.bounds;_classCallCheck(this,e),this.env=n,this.updating=i,this.bounds=r}return _createClass(e,[{key:"rerender",value:function(){var e=this.env,t=this.updating;e.begin();var n=new UpdatingVM(e);n.execute(t,this),e.commit()}},{key:"parentElement",value:function(){return this.bounds.parentElement()}},{key:"firstNode",value:function(){return this.bounds.firstNode()}},{key:"lastNode",value:function(){return this.bounds.lastNode()}},{key:"opcodes",value:function(){return this.updating}},{key:"handleException",value:function(){throw"this should never happen"}},{key:"destroy",value:function(){this.bounds.destroy()}}]),e}(),Frame=function e(t){_classCallCheck(this,e),this.operand=null,this.args=null,this.callerScope=null,this.blocks=null,this.condition=null,this.iterator=null,this.key=null,this.ops=t,this.op=t.head()},FrameStack=function(){function e(){_classCallCheck(this,e),this.frames=[],this.frame=void 0}return _createClass(e,[{key:"push",value:function(e){var t=void 0===this.frame?this.frame=0:++this.frame;this.frames.length<=t&&this.frames.push(null),this.frames[t]=new Frame(e)}},{key:"pop",value:function(){var e=this.frames,t=this.frame;e[t]=null,this.frame=0===t?void 0:t-1}},{key:"getOps",value:function(){return this.frames[this.frame].ops}},{key:"getCurrent",value:function(){return this.frames[this.frame].op}},{key:"setCurrent",value:function(e){return this.frames[this.frame].op=e}},{key:"getOperand",value:function(){return this.frames[this.frame].operand}},{key:"setOperand",value:function(e){return this.frames[this.frame].operand=e}},{key:"getArgs",value:function(){return this.frames[this.frame].args}},{key:"setArgs",value:function(e){var t=this.frames[this.frame];return t.args=e}},{key:"getCondition",value:function(){return this.frames[this.frame].condition}},{key:"setCondition",value:function(e){return this.frames[this.frame].condition=e}},{key:"getIterator",value:function(){return this.frames[this.frame].iterator}},{key:"setIterator",value:function(e){return this.frames[this.frame].iterator=e}},{key:"getKey",value:function(){return this.frames[this.frame].key}},{key:"setKey",value:function(e){return this.frames[this.frame].key=e}},{key:"getBlocks",value:function(){return this.frames[this.frame].blocks}},{key:"setBlocks",value:function(e){return this.frames[this.frame].blocks=e}},{key:"getCallerScope",value:function(){return this.frames[this.frame].callerScope}},{key:"setCallerScope",value:function(e){return this.frames[this.frame].callerScope=e}},{key:"goto",value:function(e){this.setCurrent(e)}},{key:"hasOpcodes",value:function(){return void 0!==this.frame}},{key:"nextStatement",value:function(){var e=this.frames[this.frame].op,t=this.getOps();return e?(this.setCurrent(t.nextNode(e)),e):(this.pop(),null)}}]),e}(),VM=function(){function e(t){var n=t.env,i=t.scope,r=t.dynamicScope,a=t.elementStack;_classCallCheck(this,e),this.dynamicScopeStack=new Stack,this.scopeStack=new Stack,this.updatingOpcodeStack=new Stack,this.cacheGroups=new Stack,this.listBlockStack=new Stack,this.frame=new FrameStack,this.env=n,this.elementStack=a,this.scopeStack.push(i),this.dynamicScopeStack.push(r)}return _createClass(e,[{key:"capture",value:function(){return{env:this.env,scope:this.scope(),dynamicScope:this.dynamicScope(),block:this.stack().block()}}},{key:"goto",value:function(e){this.frame.goto(e)}},{key:"beginCacheGroup",value:function(){this.cacheGroups.push(this.updatingOpcodeStack.current.tail())}},{key:"commitCacheGroup",value:function(){var e=new LabelOpcode({label:"END"}),t=this.updatingOpcodeStack.current,n=this.cacheGroups.pop(),i=n?t.nextNode(n):t.head(),r=t.tail(),a=combineSlice(new ListSlice(i,r)),s=new JumpIfNotModifiedOpcode({tag:a,target:e});t.insertBefore(s,i),t.append(new DidModifyOpcode({target:s})),t.append(e)}},{key:"enter",value:function(e){var t=new LinkedList;this.stack().pushBlock();var n=this.capture(),i=new TryOpcode({ops:e,state:n,children:t});this.didEnter(i,t)}},{key:"enterWithKey",value:function(e,t){var n=new LinkedList;this.stack().pushBlock();var i=this.capture(),r=new TryOpcode({ops:t,state:i,children:n});this.listBlockStack.current.map[e]=r,this.didEnter(r,n)}},{key:"enterList",value:function(e){var t=new LinkedList;this.stack().pushBlockList(t);var n=this.capture(),i=this.frame.getIterator().artifacts,r=new ListBlockOpcode({ops:e,state:n,children:t,artifacts:i});this.listBlockStack.push(r),this.didEnter(r,t)}},{key:"didEnter",value:function(e,t){this.updateWith(e),this.updatingOpcodeStack.push(t)}},{key:"exit",value:function(){this.stack().popBlock(),this.updatingOpcodeStack.pop();var e=this.updatingOpcodeStack.current.tail();e.didInitializeChildren()}},{key:"exitList",value:function(){this.exit(),this.listBlockStack.pop()}},{key:"updateWith",value:function(e){this.updatingOpcodeStack.current.append(e)}},{key:"stack",value:function(){return this.elementStack}},{key:"scope",value:function(){return this.scopeStack.current}},{key:"dynamicScope",value:function(){return this.dynamicScopeStack.current}},{key:"pushFrame",value:function(e){var t=e.block,n=e.args,i=e.blocks,r=e.callerScope;this.frame.push(t.ops),n&&this.frame.setArgs(n),i&&this.frame.setBlocks(i),r&&this.frame.setCallerScope(r)}},{key:"popFrame",value:function(){var e=this.frame;e.pop();var t=e.getCurrent()}},{key:"pushChildScope",value:function(){this.scopeStack.push(this.scopeStack.current.child())}},{key:"pushCallerScope",value:function(){this.scopeStack.push(this.scope().getCallerScope())}},{key:"pushDynamicScope",value:function(){this.dynamicScopeStack.push(this.dynamicScopeStack.current.child())}},{key:"pushRootScope",value:function(e,t){var n=Scope.root(e,t);return this.scopeStack.push(n),n}},{key:"popScope",value:function(){this.scopeStack.pop()}},{key:"popDynamicScope",value:function(){this.dynamicScopeStack.pop()}},{key:"newDestroyable",value:function(e){this.stack().newDestroyable(e)}},{key:"getSelf",value:function(){return this.scope().getSelf()}},{key:"referenceForSymbol",value:function(e){return this.scope().getSymbol(e)}},{key:"getArgs",value:function(){return this.frame.getArgs()}},{key:"execute",value:function(e,t){LOGGER.debug("[VM] Begin program execution");var n=this.elementStack,i=this.frame,r=this.updatingOpcodeStack,a=this.env;n.pushBlock(),r.push(new LinkedList),i.push(e),t&&t(this);for(var s=void 0;i.hasOpcodes();)(s=i.nextStatement())&&(LOGGER.debug("[VM] OP "+s.type),LOGGER.trace(s),s.evaluate(this));return LOGGER.debug("[VM] Completed program execution"),new RenderResult({env:a,updating:r.pop(),bounds:n.popBlock()})}},{key:"evaluateOpcode",value:function(e){e.evaluate(this)}},{key:"invokeBlock",value:function(e,t){var n=e.compile(this.env);this.pushFrame({block:n,args:t})}},{key:"invokeLayout",value:function(e){var t=e.args,n=e.layout,i=e.templates,r=e.callerScope;this.pushFrame({block:n,blocks:i,callerScope:r,args:t})}},{key:"evaluateOperand",value:function(e){this.frame.setOperand(e.evaluate(this))}},{key:"evaluateArgs",value:function(e){var t=this.frame.setArgs(e.evaluate(this));this.frame.setOperand(t.positional.at(0))}},{key:"bindPositionalArgs",value:function(e){var t=this.frame.getArgs();if(t)for(var n=t.positional,i=this.scope(),r=0;r<e.length;r++)i.bindSymbol(e[r],n.at(r))}},{key:"bindNamedArgs",value:function(e){var t=this.frame.getArgs();if(t)for(var n=t.named,i=Object.keys(e),r=this.scope(),a=0;a<i.length;a++)r.bindSymbol(e[i[a]],n.get(i[a]))}},{key:"bindBlocks",value:function(e){var t=this.frame.getBlocks(),n=this.frame.getCallerScope(),i=this.scope();i.bindCallerScope(n),Object.keys(e).forEach(function(n){i.bindBlock(e[n],t&&t[n]||null)})}},{key:"bindDynamicScope",value:function(e){e(this,this.dynamicScope())}}],[{key:"initial",value:function(t,n){var i=n.elementStack,r=n.self,a=n.dynamicScope,s=n.size,o=Scope.root(r,s);return new e({env:t,scope:o,dynamicScope:a,elementStack:i})}}]),e}(),Template=function(){function e(t){var n=t.raw;_classCallCheck(this,e),this.raw=n}return _createClass(e,[{key:"render",value:function(e,t,n){var i=n.dynamicScope,r=n.appendTo,a=(arguments.length<=3||void 0===arguments[3]?null:arguments[3],ElementStack.forInitialRender({dom:t.getDOM(),parentNode:r,nextSibling:null})),s=this.raw.compile(t),o=VM.initial(t,{self:e,dynamicScope:i,elementStack:a,size:s.symbols});return o.execute(s.ops)}}],[{key:"fromSpec",value:function(t,n){var i=new Scanner(t,n);return new e({raw:i.scanEntryPoint()})}},{key:"layoutFromSpec",value:function(e,t){var n=new Scanner(e,t);return n.scanLayout()}}]),e}(),SVG_NAMESPACE$1="http://www.w3.org/2000/svg",SVG_NAMESPACE="http://www.w3.org/2000/svg",SVG_INTEGRATION_POINTS={foreignObject:1,desc:1,title:1},BLACKLIST_TABLE=Object.create(null);["b","big","blockquote","body","br","center","code","dd","div","dl","dt","em","embed","h1","h2","h3","h4","h5","h6","head","hr","i","img","li","listing","main","meta","nobr","ol","p","pre","ruby","s","small","span","strong","strike","sub","sup","table","tt","u","ul","var"].forEach(function(e){return BLACKLIST_TABLE[e]=1});var DOMHelper=function(){function e(t){_classCallCheck(this,e),this.document=t,this.namespace=null,this.uselessElement=this.document.createElement("div")}return _createClass(e,[{key:"setAttribute",value:function(e,t,n){e.setAttribute(t,n)}},{key:"setAttributeNS",value:function(e,t,n,i){e.setAttributeNS(t,n,i)}},{key:"setProperty",value:function(e,t,n){e[t]=n}},{key:"removeAttribute",value:function(e,t){e.removeAttribute(t)}},{key:"removeAttributeNS",value:function(e,t,n){e.removeAttributeNS(t,n)}},{key:"createTextNode",value:function(e){return this.document.createTextNode(e)}},{key:"createComment",value:function(e){return this.document.createComment(e)}},{key:"createElement",value:function(e,t){var n=t.namespaceURI===SVG_NAMESPACE||"svg"===e,i=SVG_INTEGRATION_POINTS[t.tagName];if(n&&!i){if(BLACKLIST_TABLE[e])throw new Error("Cannot create a "+e+" inside of a <"+t.tagName+">, because it's inside an SVG context");return this.document.createElementNS(SVG_NAMESPACE,e)}return this.document.createElement(e)}},{key:"insertHTMLBefore",value:function(e,t,n){var i=e,r=t?t.previousSibling:i.lastChild,a=void 0;if(null===n||""===n)return new ConcreteBounds(i,null,null);null===t?(i.insertAdjacentHTML("beforeEnd",n),a=i.lastChild):t instanceof HTMLElement?(t.insertAdjacentHTML("beforeBegin",n),a=t.previousSibling):(i.insertBefore(this.uselessElement,t),this.uselessElement.insertAdjacentHTML("beforeBegin",n),a=this.uselessElement.previousSibling,i.removeChild(this.uselessElement));var s=r?r.nextSibling:i.firstChild;return new ConcreteBounds(i,s,a)}},{key:"insertNodeBefore",value:function(e,t,n){if(isDocumentFragment(t)){var i=t.firstChild,r=t.lastChild;return this.insertBefore(e,t,n),new ConcreteBounds(e,i,r)}return this.insertBefore(e,t,n),new SingleNodeBounds(e,t)}},{key:"insertTextBefore",value:function(e,t,n){var i=this.createTextNode(n);return this.insertBefore(e,i,t),i}},{key:"insertBefore",value:function(e,t,n){e.insertBefore(t,n)}},{key:"insertAfter",value:function(e,t,n){this.insertBefore(e,t,n.nextSibling)}}]),e}(),helper=DOMHelper,doc="undefined"==typeof document?void 0:document;helper=applyTextNodeMergingFix(doc,helper),helper=applyInnerHTMLFix(doc,helper),helper=applyInnerHTMLFix$1(doc,helper,SVG_NAMESPACE);var DOMHelper$1=helper,ComponentDefinition=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.foo="bar"}return _inherits(t,e),_createClass(t,[{key:"compile",value:function(e){return e.fromLayout(Template.layoutFromSpec(this.ComponentClass.layoutSpec,e.env))}}]),t}(IComponentDefinition),ComponentManager=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"create",value:function(e,t,n,i){var r=e.ComponentClass,a=t.named.value(),s=r.create({attrs:a});return s.didInitAttrs({attrs:a}),s.didReceiveAttrs({oldAttrs:null,newAttrs:a}),s.willInsertElement(),s.willRender(),s}},{key:"ensureCompilable",value:function(e,t){return e}},{key:"getSelf",value:function(e){return new RootReference(e)}},{key:"didCreateElement",value:function(e,t){e.element=t}},{key:"didCreate",value:function(e){e.didInsertElement(),e.didRender()}},{key:"getTag",value:function(e){return e.dirtinessTag}},{key:"update",value:function(e,t){var n=e.attrs,i=t.named.value();e.set("attrs",i),e.didUpdateAttrs({oldAttrs:n,newAttrs:i}),e.didReceiveAttrs({oldAttrs:n,newAttrs:i}),e.willUpdate(),e.willRender()}},{key:"didUpdate",value:function(e){e.didUpdate(),e.didRender()}},{key:"getDestructor",value:function(e){return e}}]),e}(),template={statements:[["openElement","div",[]],["staticAttr","class","container"],["text","\n  "],["openElement","kaomoji-list",[]],["dynamicProp","data",["unknown",["kaomoji"]]],["closeElement"],["text","\n\n  "],["openElement","div",[]],["staticAttr","class","row"],["text","\n    "],["openElement","div",[]],["staticAttr","class","twelve columns contribute"],["text","\n      Want to contribute? Check out this project on "],["openElement","a",[]],["staticAttr","href","https://github.com/vevix/kaomoji"],["text","GitHub"],["closeElement"],["text","\n    "],["closeElement"],["text","\n    "],["openElement","div",[]],["staticAttr","class","twelve columns me"],["text","\n      "],["openElement","span",[]],["staticAttr","class","kaomoji"],["text","( ) "],["closeElement"],["text"," "],["openElement","a",[]],["staticAttr","href","https://twitter.com/@vevix_"],["text","@vevix_"],["closeElement"],["text","\n    "],["closeElement"],["text","\n  "],["closeElement"],["text","\n"],["closeElement"],["text","\n"]],locals:[],named:[],yields:[],blocks:[],meta:null},DynamicScope=function(){function e(t){_classCallCheck(this,e),this.view=t}return _createClass(e,[{key:"set",value:function(e){assign(this,e)}},{key:"child",value:function(){return new e(this.view)}}]),e}(),componentManager=new ComponentManager,Application=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e||new DOMHelper$1(document)),this.components=dict(),this.scope=new DynamicScope(null)}return _inherits(t,e),_createClass(t,[{key:"model",value:function(e){return new RootReference(e)}},{key:"render",value:function(e,t){this.begin(),this.app=Template.fromSpec(template,this);var n=this.app.render(e,this,{dynamicScope:this.scope,appendTo:t});return this.commit(),n}},{key:"registerComponent",value:function(e,t){var n=new ComponentDefinition(e,componentManager,t);return this.components[e]=n,n}},{key:"hasComponentDefinition",value:function(e){return!!this.components[e[0]]}},{key:"getComponentDefinition",value:function(e){return this.components[e[0]]}},{key:"hasHelper",value:function(){return!1}},{key:"hasModifier",value:function(){return!1}},{key:"hasPartial",value:function(){return!1}},{key:"iterableFor",value:function(e,t){var n=t.named.get("key").value(),i=void 0;if(!n)throw new Error("Must specify a key for #each");switch(n){case"@index":i=function(e,t){return String(t)};break;case"@primitive":i=function(e){return String(e)};break;default:i=function(e){return e[n]}}return new Iterable(e,i)}}]),t}(Environment),ArrayIterator=function(){function e(t,n){_classCallCheck(this,e),this.position=0,this.array=t,this.keyFor=n}return _createClass(e,[{key:"isEmpty",value:function(){return 0===this.array.length}},{key:"next",value:function(){var e=this.position,t=this.array,n=this.keyFor;if(e>=t.length)return null;var i=t[e],r=n(i,e),a=e;return this.position++,{key:r,value:i,memo:a}}}]),e}(),ObjectKeysIterator=function(){function e(t,n,i){_classCallCheck(this,e),this.position=0,this.keys=t,this.values=n,this.keyFor=i}return _createClass(e,[{key:"isEmpty",value:function(){return 0===this.keys.length}},{key:"next",value:function(){var e=this.position,t=this.keys,n=this.values,i=this.keyFor;if(e>=t.length)return null;var r=n[e],a=t[e],s=i(r,a);return this.position++,{key:s,value:r,memo:a}}}]),e}(),EmptyIterator=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"isEmpty",value:function(){return!0}},{key:"next",value:function(){throw new Error("Cannot call next() on an empty iterator")}}]),e}(),EMPTY_ITERATOR=new EmptyIterator,Iterable=function(){function e(t,n){_classCallCheck(this,e),this.ref=t,this.keyFor=n}return _createClass(e,[{key:"iterate",value:function(){var e=this.ref,t=this.keyFor,n=e.value();if(Array.isArray(n))return n.length>0?new ArrayIterator(n,t):EMPTY_ITERATOR;if(void 0===n.forEach){if(void 0===n||null===n)return EMPTY_ITERATOR;if("object"==typeof n){var i=Object.keys(n);return i.length>0?new ObjectKeysIterator(i,i.map(function(e){return n[e]}),t):EMPTY_ITERATOR}throw new Error("Dont know how to {{#each "+n+"}}")}var r=function(){var e=[];return n.forEach(function(t){e.push(t)}),{v:e.length>0?new ArrayIterator(e,t):EMPTY_ITERATOR}}();return"object"==typeof r?r.v:void 0}},{key:"valueReferenceFor",value:function(e){return new RootReference(e.value)}},{key:"updateValueReference",value:function(e,t){e.update(t.value)}},{key:"memoReferenceFor",value:function(e){return new RootReference(e.memo)}},{key:"updateMemoReference",value:function(e,t){e.update(t.memo)}}]),e}(),Component$1=function(){function e(t){_classCallCheck(this,e),this.element=null,this.attrs=t}return _createClass(e,[{key:"set",value:function(e,t){this[e]=t}},{key:"didInitAttrs",value:function(){}},{key:"didUpdateAttrs",value:function(){}},{key:"didReceiveAttrs",value:function(){}},{key:"willInsertElement",value:function(){}},{key:"willUpdate",value:function(){}},{key:"willRender",value:function(){}},{key:"didInsertElement",value:function(){}},{key:"didUpdate",value:function(){}},{key:"didRender",value:function(){}}],[{key:"create",value:function(e){var t=e.attrs;return new this(t)}}]),e}(),template$1={statements:[["openElement","div",[]],["staticAttr","class","row"],["text","\n  "],["openElement","div",[]],["staticAttr","class","twelve columns"],["text","\n    "],["openElement","select",[]],["text","\n      "],["openElement","option",[]],["staticAttr","value",""],["text","ALL THE KAOMOJI! ___()"],["closeElement"],["text","\n"],["block",["each"],[["attr",["data"]]],{key:"@index"},2],["text","    "],["closeElement"],["text","\n  "],["closeElement"],["text","\n"],["closeElement"],["text","\n\n"],["openElement","div",[]],["staticAttr","class","row"],["text","\n  "],["openElement","div",[]],["staticAttr","class","twelve columns kaomoji-list"],["text","\n"],["block",["each"],[["get",["kaomoji"]]],{key:"@index"},0],["text","  "],["closeElement"],["text","\n"],["closeElement"]],locals:[],named:["data"],yields:[],blocks:[{statements:[["text","      "],["openElement","kaomoji-item",[]],["dynamicProp","kaomoji",["unknown",["kaomoji"]]],["closeElement"],["text","\n"]],locals:["kaomoji"]},{statements:[["text","            "],["openElement","option",[]],["dynamicProp","value",["unknown",["item","category"]]],["append",["unknown",["item","category"]],!1],["closeElement"],["text","\n"]],locals:["item"]},{statements:[["text","        "],["openElement","optgroup",[]],["dynamicProp","label",["unknown",["item","category"]]],["text","\n"],["block",["each"],[["get",["item","kaomojis"]]],{key:"@index"},1],["text","        "],["closeElement"],["text","\n"]],locals:["item"]}],meta:null},KaomojiList=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.selectedCategory="",this.actions={change:function(e){var t=e.target.value;this.set("selectedCategory",t),window.view.rerender()}}}return _inherits(t,e),_createClass(t,[{key:"didInsertElement",value:function(){var e=this.element.getElementsByTagName("select")[0];e.addEventListener("change",this.actions.change.bind(this))}},{key:"kaomoji",get:function(){var e=this,t=[];return this.attrs.data.map(function(e){return e.kaomojis}).forEach(function(n){var i=n.filter(function(t){return""===e.selectedCategory||e.selectedCategory===t.category}).map(function(e){return e.kaomoji});i.length>0&&t.push(i.reduce(function(e,t){return e.concat(t)}))}),t.reduce(function(e,t){return e.concat(t)})}}]),t}(Component$1);KaomojiList.layoutSpec=template$1;var template$2={statements:[["openElement","button",[]],["staticAttr","class","kaomoji-item"],["text","\n  "],["append",["attr",["kaomoji"]],!1],["text","\n"],["closeElement"]],locals:[],named:["kaomoji"],yields:[],blocks:[],meta:null},KaomojiList$1=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.clipboard=null,this.actions={success:function(e){this.notify("success",e.text+" -- copied to clipboard!")},error:function(){this.notify("error","Failed to copy kaomoji to the clipboard ()")}}}return _inherits(t,e),_createClass(t,[{key:"didRender",value:function(){var e=this.attrs;null===this.clipboard&&(this.clipboard=new Clipboard(this.element,{action:function(){return"copy"},text:function(){return e.kaomoji}}),this.clipboard.on("success",this.actions.success.bind(this)),this.clipboard.on("error",this.actions.error.bind(this)))}},{key:"didUpdateAttrs",value:function(e){var t=e.newAttrs;null!==this.clipboard&&(this.clipboard.text=function(){return t.kaomoji})}},{key:"destroy",value:function(){this.clipboard.destroy(),this.clipboard=null}},{key:"notify",value:function(e,t){alertify.delay(1e3)[e].call(alertify,t)}}]),t}(Component$1);KaomojiList$1.layoutSpec=template$2;var kaomoji=[{category:"positive",kaomojis:[{category:"happy",kaomoji:["(*^^)","()","(*)","(^^)","()","(  `)","()","(*^^*)","(o^^o)","()","()","(**)","()","(oo)","(**)","()","()","( )","(-^^-)","( )/","^^)","()","(^^)","(^^)"]},{category:"love",kaomoji:["()","(_)","(*^^*)","()","()","( ) ","()","()","(  )","()","()","(  )","()","(--)","( )","(o)","()"," ) ~"]},{category:"embarrassment",kaomoji:["(_;)","(o^ ^o)","(*/)","(*/_)","(*)","(.)","(*`*)","(**)","(*^.^*)","(oo)/"]}]},{category:"neutral",kaomojis:[{category:"meh",kaomoji:["(_ )","()","(_)","()","(    )","\\_()_/"]},{category:"confusion",kaomoji:["(-)","( ) ?","(_)?","()","(^^;)","(.)7","(__)","(_)","(_)","()*","( o)","( -_)?"]},{category:"doubt",kaomoji:["(_)","(_)","(_)","(_ )","(_)","(_)"]},{category:"surprised",kaomoji:["w()w","(_)","(*)"]}]},{category:"negative",kaomojis:[{category:"sad",kaomoji:["()","()","()","(_)"]},{category:"angry",kaomoji:["( )","()","(/)/","( )( oo)","(  \t","()","()","()","(  )","( )_"]},{category:"worried",kaomoji:["()","","( )"]}]},{category:"action",kaomojis:[{category:"sorry",kaomoji:["(_ _)","m(_ _)m","(. .)","(^)(_ _ ;)"]},{category:"winking",kaomoji:["(^_-)","(^~)","(*)"]},{category:"writing",kaomoji:["__()","( )__","__( )","__(;)","( `)__","___()"]},{category:"running",kaomoji:["=((( )","====(;)","==( >_<)","===()","(;)=3=3=3","()","===()","==(*`)"]},{category:"sleeping",kaomoji:["() zzZ","(( _ _ ))..zzzZZ","(*)"]},{category:"misc",kaomoji:["()","( )"]}]}],app=new Application;app.registerComponent("kaomoji-list",KaomojiList),app.registerComponent("kaomoji-item",KaomojiList$1);var model=app.model({kaomoji:kaomoji});window.view=app.render(model,document.getElementById("content"));